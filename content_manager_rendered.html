
<!DOCTYPE html>
<html lang="en">

<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Management360 platform description">
    <meta name="keywords" content="management, platform, business">
    <meta name="author" content="Management360">

    
    <title>Gestor de Contenido - CMS - Management360</title>

    
    <link rel="icon" href="/static/assets/img/favicon.png">
    <link rel="apple-touch-icon" href="https://cdn.glitch.com/49d34dc6-8fbd-46bb-8221-b99ffd36f1af%2Ftouchicon-180.png?v=1566411949736">

    
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i">
    <link rel="preload" as="style" href="/static/assets/css/style.css">

    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i">
    </noscript>

    
    <link rel="stylesheet" href="/static/assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/assets/vendor/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/assets/vendor/boxicons/css/boxicons.min.css">
    <link rel="stylesheet" href="/static/assets/vendor/remixicon/remixicon.css">
    
    
    <link rel="stylesheet" href="/static/assets/vendor/quill/quill.snow.css">
    <link rel="stylesheet" href="/static/assets/vendor/quill/quill.bubble.css">
    <link rel="stylesheet" href="/static/assets/vendor/simple-datatables/style.css">

    
    <link rel="stylesheet" href="/static/assets/css/style.css">
    <link rel="stylesheet" href="/static/assets/css/alerts-styles.css">
    <link rel="stylesheet" href="/static/assets/css/chat.css">

    
    
    <link rel="stylesheet" href="/static/assets/css/inbox_floating_button.css">
    

    
    
<!-- CSS para el Gestor de Contenido -->
<link rel="stylesheet" href="/static/css/content_manager.css">

</head>

<body data-user-authenticated="true">
    
    
<header id="header" class="header fixed-top d-flex align-items-center">
    <div class="d-flex align-items-center justify-content-between">
        <a href="/" class="logo d-flex align-items-center">
            <img src="/static/assets/img/logo.png" alt="">
            <span class="d-none d-lg-block">Management360</span>
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->
    <div class="search-bar">
        <form class="search-form d-flex align-items-center" method="GET" action="/search/">
            <input type="text" name="query" placeholder="Search" 
                   title="Enter search keyword" value="">
            <button type="submit" title="Search"><i class="bi bi-search"></i></button>
        </form>
    </div><!-- End Search Bar -->
    <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
            <li class="nav-item d-block d-lg-none">
                <a class="nav-link nav-icon search-bar-toggle " href="#">
                    <i class="bi bi-search"></i>
                </a>
            </li><!-- End Search Icon-->
            <span> &nbsp; &nbsp;</span>
            
            <li class="nav-item dropdown">
    <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
        <i class="bi bi-coin"></i>
        <span class="badge bg-primary badge-number">8537.06</span>
    </a><!-- End Credit Icon -->
    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">
        <li class="dropdown-header">
            Credit Account
            <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">Manage</span></a>
        </li>
        <li>
            <hr class="dropdown-divider">
        </li>
        <li class="notification-item">
            <i class="bi bi-wallet2 text-success"></i>
            <div>
                <h4>Recharge Credits</h4>
                <p>Add funds to your credit account.</p>
            </div>
        </li>
        <li>
            <hr class="dropdown-divider">
        </li>
        <li class="notification-item">
            <i class="bi bi-arrow-left-right text-warning"></i>
            <div>
                <h4>Transfer Credits</h4>
                <p>Send credits to another user.</p>
            </div>
        </li>
        <li>
            <hr class="dropdown-divider">
        </li>
        <li class="notification-item">
            <i class="bi bi-receipt text-info"></i>
            <div>
                <h4>Transaction History</h4>
                <p>View your credit transactions.</p>
            </div>
        </li>
        <li>
            <hr class="dropdown-divider">
        </li>
        <li class="dropdown-footer">
            <a href="#">More credit options</a>
        </li>
    </ul><!-- End Credit Dropdown Items -->
</li><!-- End Credit Nav -->

            <!-- Unified Notifications Icon -->
            <li class="nav-item dropdown">
                <a class="nav-link nav-icon position-relative" href="#" id="header-notifications-btn" data-bs-toggle="dropdown" title="Notifications">
                    <i class="bi bi-bell"></i>
                    <span id="header-notification-badge" class="badge bg-danger badge-number" style="display:none;position:absolute;top:-5px;right:-5px;">0</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications" style="min-width: 350px;max-height: 500px;overflow-y: auto;">
                    <li class="dropdown-header d-flex justify-content-between align-items-center">
                        <span>Notifications</span>
                        <button id="header-mark-all-read-btn" class="btn btn-sm btn-outline-primary" style="display: none;">Mark All Read</button>
                    </li>

                    <li id="header-notifications-list">
                        <div class="text-center p-4">
                            <i class="bi bi-bell-slash fs-1 text-muted"></i>
                            <p class="text-muted mt-2">No notifications</p>
                        </div>
                    </li>

                    <li class="dropdown-footer">
                        <a href="/chat/">View all notifications</a>
                    </li>
                </ul>
            </li>
            <!-- End Unified Notifications Icon -->

            <li class="nav-item dropdown">
                <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                    <i class="bi bi-bell"></i>
                    <span class="badge bg-primary badge-number">4</span>
                </a><!-- End Notification Icon -->
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">
                    <li class="dropdown-header">
                        You have 4 new notifications
                        <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">View all</span></a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li class="notification-item">
                        <i class="bi bi-exclamation-circle text-warning"></i>
                        <div>
                            <h4>Lorem Ipsum</h4>
                            <p>Quae dolorem earum veritatis oditseno</p>
                            <p>30 min. ago</p>
                        </div>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li class="notification-item">
                        <i class="bi bi-x-circle text-danger"></i>
                        <div>
                            <h4>Atque rerum nesciunt</h4>
                            <p>Quae dolorem earum veritatis oditseno</p>
                            <p>1 hr. ago</p>
                        </div>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li class="notification-item">
                        <i class="bi bi-check-circle text-success"></i>
                        <div>
                            <h4>Sit rerum fuga</h4>
                            <p>Quae dolorem earum veritatis oditseno</p>
                            <p>2 hrs. ago</p>
                        </div>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li class="notification-item">
                        <i class="bi bi-info-circle text-primary"></i>
                        <div>
                            <h4>Dicta reprehenderit</h4>
                            <p>Quae dolorem earum veritatis oditseno</p>
                            <p>4 hrs. ago</p>
                        </div>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li class="dropdown-footer">
                        <a href="#">Show all notifications</a>
                    </li>
                </ul><!-- End Notification Dropdown Items -->
            </li><!-- End Notification Nav -->
            <li class="nav-item dropdown pe-3">
                <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                    
                    <img src="http://192.168.18.46:8000/profile_pics/thumb-1920-29144.jpg" alt="Profile" class="rounded-circle">
                    
                    <span class="d-none d-md-block dropdown-toggle ps-2">Superusuario</span>
                </a>
                </a><!-- End Profile Image Icon -->
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                    <li class="dropdown-header">
                        <h6>Superusuario</h6>
                        <span>AD</span>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="/cv/">
                            <i class="bi bi-person"></i>
                            <span>My Profile</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="/cv/editar/">
                            <i class="bi bi-gear"></i>
                            <span>Account Settings</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="/about/">
                            <i class="bi bi-question-circle"></i>
                            <span>Need Help?</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="/accounts/logout/">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>Log Out</span>
                        </a>
                    </li>
                </ul><!-- End Profile Dropdown Items -->
            </li><!-- End Profile Nav -->
            
        </ul>
    </nav><!-- End Icons Navigation -->
</header><!-- End Header -->

    
    
<!-- ======= Sidebar ======= -->
<aside id="sidebar" class="sidebar">
    <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-item">
    <a class="nav-link " href="/">
        <i class="bi bi-grid"></i>
        <span>Dashboard</span>
    </a>
</li><!-- End Dashboard Nav -->
        
        <!-- =======================================================
     OPTIMIZED PROJECTS SECTION
     ======================================================= -->
<li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#projects-nav" data-bs-toggle="collapse" href="/events/projects/">
        <i class="bi bi-calendar3-range"></i><span>Projects</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="projects-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
        <!-- Main Views -->
        <li>
            <a href="/events/projects/">
                <i class="bi bi-list-ul"></i><span>All Projects</span>
            </a>
        </li>
        <li>
            <a href="/events/projects/panel/">
                <i class="bi bi-speedometer2"></i><span>Project Panel</span>
            </a>
        </li>

        <!-- Actions -->
        
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#project-actions-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-gear"></i><span>Project Actions</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="project-actions-nav" class="nav-content collapse" data-bs-parent="#projects-nav">
                <li>
                    <a href="/events/projects/create/">
                        <i class="bi bi-plus-circle"></i><span>Create Project</span>
                    </a>
                </li>
                <li>
                    <a href="/events/projects/edit/">
                        <i class="bi bi-pencil"></i><span>Edit Project</span>
                    </a>
                </li>
                <li>
                    <a href="/events/projects/activate/">
                        <i class="bi bi-play-circle"></i><span>Activate Project</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Templates -->
        <li>
            <a href="/events/templates/">
                <i class="bi bi-file-earmark-plus"></i><span>Project Templates</span>
            </a>
        </li>

        <!-- Reports -->
        <li>
            <a href="/events/projects/export/">
                <i class="bi bi-download"></i><span>Export Projects</span>
            </a>
        </li>
        
    </ul>
</li><!-- End Optimized Projects Nav -->

        <!-- =======================================================
     OPTIMIZED TASKS SECTION
     ======================================================= -->
<li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#tasks-nav" data-bs-toggle="collapse" href="/events/tasks/">
        <i class="bi bi-calendar-check"></i><span>Tasks</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="tasks-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">

        <!-- Main Views -->
        <li>
            <a href="/events/tasks/">
                <i class="bi bi-list-ul"></i><span>All Tasks</span>
            </a>
        </li>
        <li>
            <a href="/events/tasks/panel/">
                <i class="bi bi-speedometer2"></i><span>Task Panel</span>
            </a>
        </li>

        <!-- Actions -->
        
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#task-actions-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-gear"></i><span>Task Actions</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="task-actions-nav" class="nav-content collapse" data-bs-parent="#tasks-nav">
                <li>
                    <a href="/events/tasks/create/">
                        <i class="bi bi-plus-circle"></i><span>Create Task</span>
                    </a>
                </li>
                <li>
                    <a href="/events/tasks/edit/">
                        <i class="bi bi-pencil"></i><span>Edit Task</span>
                    </a>
                </li>
                <li>
                    <a href="/events/tasks/activate/">
                        <i class="bi bi-play-circle"></i><span>Activate Task</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Advanced Task Features -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#task-advanced-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-diagram-3"></i><span>Advanced Features</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="task-advanced-nav" class="nav-content collapse" data-bs-parent="#tasks-nav">
                <li>
                    <a href="/events/dependencies/">
                        <i class="bi bi-link"></i><span>Task Dependencies</span>
                    </a>
                </li>
                <li>
                    <a href="/events/dependencies/">
                        <i class="bi bi-list-ul"></i><span>All Dependencies</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Reports -->
        <li>
            <a href="/events/tasks/export/">
                <i class="bi bi-download"></i><span>Export Tasks</span>
            </a>
        </li>
        
    </ul>
</li><!-- End Optimized Tasks Nav -->

        <!-- =======================================================
     OPTIMIZED EVENTS SECTION
     ======================================================= -->
<li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#events-nav" data-bs-toggle="collapse" href="/events/events/">
        <i class="bi bi-calendar-event"></i><span>Events</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="events-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
        <!-- Main Views -->
        <li>
            <a href="/events/events/">
                <i class="bi bi-list-ul"></i><span>All Events</span>
            </a>
        </li>
        <li>
            <a href="/events/events/panel/">
                <i class="bi bi-speedometer2"></i><span>Event Panel</span>
            </a>
        </li>

        <!-- Actions -->
        
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#event-actions-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-gear"></i><span>Event Actions</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="event-actions-nav" class="nav-content collapse" data-bs-parent="#events-nav">
                <li>
                    <a href="/events/events/create/">
                        <i class="bi bi-plus-circle"></i><span>Create Event</span>
                    </a>
                </li>
                <li>
                    <a href="/events/events/panel/">
                        <i class="bi bi-pencil"></i><span>Edit Event</span>
                    </a>
                </li>
                <li>
                    <a href="/events/events/assign/">
                        <i class="bi bi-person-plus"></i><span>Assign Attendees</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- History & Reports -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#event-reports-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-bar-chart"></i><span>History & Reports</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="event-reports-nav" class="nav-content collapse" data-bs-parent="#events-nav">
                <li>
                    <a href="/events/events/history/">
                        <i class="bi bi-clock-history"></i><span>Event History</span>
                    </a>
                </li>
                <li>
                    <a href="/events/events/export/">
                        <i class="bi bi-download"></i><span>Export Events</span>
                    </a>
                </li>
            </ul>
        </li>
        
    </ul>
</li><!-- End Optimized Events Nav -->


        <!-- =======================================================
     OPTIMIZED MANAGEMENT SECTION
     ======================================================= -->
<li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#management-nav" data-bs-toggle="collapse" href="/events/dashboard/">
        <i class="bi bi-card-checklist"></i><span>Management</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="management-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">

        <!-- Main Dashboard -->
        <li>
            <a href="/events/dashboard/">
                <i class="bi bi-speedometer2"></i><span>Unified Dashboard</span>
            </a>
        </li>

        <!-- Core Management -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#core-management-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-diagram-3"></i><span>Core Management</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="core-management-nav" class="nav-content collapse" data-bs-parent="#management-nav">
                <li>
                    <a href="/events/management/">
                        <i class="bi bi-circle"></i><span>Management Index</span>
                    </a>
                </li>
                <li>
                    <a href="/events/panel/">
                        <i class="bi bi-circle"></i><span>Main Panel</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Productivity Tools -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#productivity-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-lightning"></i><span>Productivity Tools</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="productivity-nav" class="nav-content collapse" data-bs-parent="#management-nav">
                <li>
                    <a href="/events/kanban/">
                        <i class="bi bi-kanban"></i><span>Kanban Board</span>
                    </a>
                </li>
                <li>
                    <a href="/events/eisenhower/">
                        <i class="bi bi-grid-3x3"></i><span>Eisenhower Matrix</span>
                    </a>
                </li>
                <li>
                    <a href="/events/inbox/">
                        <i class="bi bi-inbox"></i><span>GTD Inbox</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Advanced Features -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#advanced-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-gear"></i><span>Advanced Features</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="advanced-nav" class="nav-content collapse" data-bs-parent="#management-nav">
                <li>
                    <a href="/events/dependencies/">
                        <i class="bi bi-link"></i><span>Task Dependencies</span>
                    </a>
                </li>
                <li>
                    <a href="/events/templates/">
                        <i class="bi bi-file-earmark-plus"></i><span>Project Templates</span>
                    </a>
                </li>
                <li>
                    <a href="/events/reminders/">
                        <i class="bi bi-bell"></i><span>Reminders</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Quick Actions -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#quick-actions-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-bolt"></i><span>Quick Actions</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="quick-actions-nav" class="nav-content collapse" data-bs-parent="#management-nav">
                <li>
                    <a href="/events/events/create/">
                        <i class="bi bi-plus-circle"></i><span>Create Event</span>
                    </a>
                </li>
                <li>
                    <a href="/events/projects/create/">
                        <i class="bi bi-plus-circle"></i><span>Create Project</span>
                    </a>
                </li>
                <li>
                    <a href="/events/tasks/create/">
                        <i class="bi bi-plus-circle"></i><span>Create Task</span>
                    </a>
                </li>
                <li>
                    <a href="/events/templates/create/">
                        <i class="bi bi-plus-circle"></i><span>Create Template</span>
                    </a>
                </li>
            </ul>
        </li>

        <!-- Reports & Analytics -->
        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#reports-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-bar-chart"></i><span>Reports & Analytics</span><i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="reports-nav" class="nav-content collapse" data-bs-parent="#management-nav">
                <li>
                    <a href="/events/events/export/">
                        <i class="bi bi-download"></i><span>Export Events</span>
                    </a>
                </li>
                <li>
                    <a href="/events/projects/export/">
                        <i class="bi bi-download"></i><span>Export Projects</span>
                    </a>
                </li>
                <li>
                    <a href="/events/tasks/export/">
                        <i class="bi bi-download"></i><span>Export Tasks</span>
                    </a>
                </li>
            </ul>
        </li>

    </ul>
</li><!-- End Optimized Management Nav -->

        <li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#cv-nav" data-bs-toggle="collapse" href="/cv/">
        <i class="bi bi-calendar"></i><span>Profile</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="cv-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">

        <li>
            <a href="/cv/">
                <i class="bi bi-circle"></i><span>My Profile</span>
            </a>
        </li>
        <li>
            <a href="/cv/editar/">
                <i class="bi bi-circle"></i><span>Profile Edit</span>
            </a>
        </li>

  
    </ul>
</li><!-- End cv Nav -->

        <li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#reports-nav" data-bs-toggle="collapse" href="#">
        <i class="bi bi-file-earmark-spreadsheet"></i><span>Reports</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="reports-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
        <li>
            <a href="/kpis/">
                <i class="bi bi-graph-up"></i><span>KPI Home</span>
            </a>
        </li>
        <li>
            <a href="/kpis/dashboard/">
                <i class="bi bi-bar-chart-line"></i><span>AHT Dashboard</span>
            </a>
        </li>
        
        <li>
            <a href="/kpis/generate-data/">
                <i class="bi bi-file-pdf"></i><span>Generate Data</span>
            </a>
        </li>
        <li>
            <a href="/tools/upload-data/upload/">
                <i class="bi bi-upload"></i><span>Upload data</span>
            </a>
        </li>
        
    </ul>
</li><!-- End Reports Nav -->
        <li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#rooms-nav" data-bs-toggle="collapse" href="/rooms/">
        <i class="bi bi-columns-gap"></i><span>rooms</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="rooms-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
        <li>
            <a href="/rooms/">
                <i class="bi bi-circle"></i><span>Lobbby</span>
            </a>
        </li>
        <li>
            <a href="/rooms/rooms/">
                <i class="bi bi-circle"></i><span>Rooms</span>
            </a>
        </li>
        
        <li>
            <a href="/rooms/rooms/create/">
                <i class="bi bi-circle"></i><span>Create room</span>
            </a>
        </li>
        <li>
            <a href="/rooms/entrance-exits/">
                <i class="bi bi-circle"></i><span>Entrances</span>
            </a>
        </li>
        <li>
            <a href="/rooms/portals/">
                <i class="bi bi-circle"></i><span>Portals</span>
            </a>
        </li>

        

    </ul>
</li><!-- End rooms Nav -->

        <li class="nav-item">

    <a class="nav-link collapsed" data-bs-target="#tools-nav" data-bs-toggle="collapse" href="/tools/upload-data/upload/">
        <i class="bi bi-calendar-event"></i><span>tools</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="tools-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
        <li>
                <a href="/tools/tools/calculate_agents/">
                    <i class="bi bi-circle"></i><span>Calculate Agents</span>
                </a>
        </li>
        <li>
            <a href="/tools/tools/file-tree/">
                <i class="bi bi-circle"></i><span>File Tree</span>
                
            </a>
        </li>
        <li>
       <li>
            <a href="/tools/upload-data/upload/">
                <i class="bi bi-circle"></i><span>upload data</span>
            </a>
        </li>
        
        </li>
    </ul>
</li><!-- End tools Nav -->

        <li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#configuration-nav" data-bs-toggle="collapse" href="#">
        <i class="bi bi-gear"></i><span>Configuration</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="configuration-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
        <!-- Crear nueva tipificación -->
        <li>
            <a href="/events/configuration/status/">
                <i class="bi bi-circle"></i><span>Status Panel</span>
            </a>
        </li>

        <!-- Gestionar classificationes -->
        <li>
            <a href="/events/configuration/status/create/">
                <i class="bi bi-circle"></i><span>Status Create</span>
            </a>
        </li>

        <!-- Divider -->
        <li>
            <hr class="dropdown-divider">

        </li>

        <!-- Crear nuevo estado -->
        <li>
            <a href="/events/configuration/status/edit/">
                <i class="bi bi-circle"></i><span>Status Edit</span>
            </a>
        </li>
    </ul>
</li><!-- End configuration Nav -->

        <li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#chat-nav" data-bs-toggle="collapse" href="#">
        <i class="bi bi-chat-dots"></i><span>Chat</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="chat-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
        <li>
            <a href="/chat/">
                <i class="bi bi-circle"></i><span>General Chat</span>
            </a>
        </li>
        <li>
            <a href="/chat/ui/">
                <i class="bi bi-robot"></i><span>Chat IA</span>
            </a>
        </li>
    </ul>
</li>

        <li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#courses-nav" data-bs-toggle="collapse" href="/courses/">
        <i class="bi bi-journal-bookmark"></i><span>Cursos</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="courses-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
        <!-- Sección de Aprendizaje -->
        <li class="nav-heading">Aprendizaje</li>
        <li>
            <a href="/courses/courses/">
                <i class="bi bi-search"></i><span>Explorar Cursos</span>
            </a>
        </li>
        
        <li>
            <a href="/courses/dashboard/">
                <i class="bi bi-speedometer2"></i><span>Mi Dashboard</span>
            </a>
        </li>

        <!-- Sección de Gestión de Contenido (solo tutores) -->
        
        <li class="nav-heading">Gestión de Contenido</li>
        <li>
            <a href="/courses/manage/">
                <i class="bi bi-folder-fill"></i><span>Mis Cursos</span>
            </a>
        </li>
        <li>
            <a href="/courses/manage/create/">
                <i class="bi bi-plus-circle-fill"></i><span>Crear Curso</span>
            </a>
        </li>
        <li>
            <a href="/courses/modules/overview/">
                <i class="bi bi-diagram-3-fill"></i><span>Gestionar Módulos</span>
            </a>
        </li>
        

        <!-- Sección Administrativa (solo staff) -->
        
        <li class="nav-heading">Administración</li>
        <li>
            <a href="/courses/admin/">
                <i class="bi bi-shield-check"></i><span>Panel Admin</span>
            </a>
        </li>
        <li>
            <a href="/courses/admin/users/">
                <i class="bi bi-people-fill"></i><span>Gestionar Usuarios</span>
            </a>
        </li>
        <li>
            <a href="/courses/manage/categories/">
                <i class="bi bi-tags-fill"></i><span>Categorías</span>
            </a>
        </li>
        
        
    </ul>
</li><!-- End courses Nav -->

        
        <li class="nav-item">
    <a class="nav-link collapsed" data-bs-target="#accounts-nav" data-bs-toggle="collapse" href="/accounts/">
        <i class="bi bi-person-gear"></i><span>Account</span><i class="bi bi-chevron-down ms-auto"></i>
    </a>
    <ul id="accounts-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
        <li>
            <a href="/accounts/">
                <i class="bi bi-circle"></i><span>My Account</span>
            </a>
        </li>
        
        <li>
            <a href="/accounts/password-change/">
                <i class="bi bi-circle"></i><span>Change Password</span>
            </a>
        </li>
        <li>
            <a href="/accounts/logout/">
                <i class="bi bi-circle"></i><span>Log Out</span>
            </a>
        </li>
        
    </ul>
</li><!-- End Account Nav -->
        
<!-- pages.html -->

<li class="nav-heading">Pages</li>

<li class="nav-item">
    <a class="nav-link collapsed" href="/cv/">
        <i class="bi bi-person"></i>
        <span>Profile</span>
    </a>
</li><!-- End Profile Page Nav -->

<li class="nav-item">
    <a class="nav-link collapsed" href="/faq/">
        <i class="bi bi-question-circle"></i>
        <span>F.A.Q</span>
    </a>
</li><!-- End F.A.Q Page Nav -->

<li class="nav-item">
    <a class="nav-link collapsed" href="/contact/">
        <i class="bi bi-envelope"></i>
        <span>Contact</span>
    </a>
</li><!-- End Contact Page Nav -->

<li class="nav-item">
    <a class="nav-link collapsed" href="/about/">
        <i class="bi bi-info-circle"></i>
        <span>About</span>
    </a>    

</li><!-- End About Page Nav -->


    </ul>

    <style>
    /* Estilos para los encabezados de sección en la navegación */
    .nav-heading {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #6c757d;
        padding: 0.75rem 1rem 0.25rem 1rem;
        margin: 0.5rem 0 0.25rem 0;
        border-bottom: 1px solid rgba(108, 117, 125, 0.2);
    }

    .nav-heading:first-child {
        margin-top: 0;
    }

    /* Mejorar el espaciado de los elementos de navegación */
    .sidebar-nav .nav-item .nav-content li {
        margin-bottom: 0.125rem;
    }

    .sidebar-nav .nav-item .nav-content li a {
        padding: 0.5rem 1rem 0.5rem 2.5rem;
        font-size: 0.875rem;
        transition: all 0.2s ease;
    }

    .sidebar-nav .nav-item .nav-content li a:hover {
        background-color: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
    }

    /* Iconos más prominentes */
    .sidebar-nav .nav-item .nav-content li a i {
        font-size: 0.8rem;
        width: 16px;
        text-align: center;
        margin-right: 0.5rem;
        opacity: 0.8;
    }

    .sidebar-nav .nav-item .nav-content li a:hover i {
        opacity: 1;
    }
    </style>
</aside><!-- End Sidebar-->
    
    
    <main id="main" class="main">
        
        

        
        
        <div class="container-fluid">
            
            <form id="csrf-form" style="display: none;">
                <input type="hidden" name="csrfmiddlewaretoken" value="9WvBfn1Y3M8ClhE7Zv3c7HYEuWfv2xx9c2EWcFtjgbbACfNBhTRrnPU8UxaNfWOx">
            </form>

            
<div class="container mt-4">
    <!-- Barra de navegación superior responsiva -->
    <div class="row mb-4">
        <div class="col-12">
            <nav class="navbar navbar-expand-lg navbar-light bg-light rounded shadow-sm">
                <div class="container-fluid">
                    <!-- Botón para móviles -->
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#coursesNavbar" aria-controls="coursesNavbar" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <!-- Contenido del navbar -->
                    <div class="collapse navbar-collapse" id="coursesNavbar">
                        <!-- Categorías -->
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="categoriesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-tags me-1"></i>Categorías
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="categoriesDropdown">
                                    <li><a class="dropdown-item" href="/courses/courses/">
                                        <i class="fas fa-list me-2"></i>Todos los cursos
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                </ul>
                            </li>
                        </ul>

                        <!-- Acciones principales -->
                        <ul class="navbar-nav mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link" href="/courses/courses/">
                                    <i class="fas fa-search me-1"></i>Explorar Cursos
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="/courses/dashboard/">
                                    <i class="fas fa-tachometer-alt me-1"></i>Mi Dashboard
                                </a>
                            </li>
                            
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="contentDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-edit me-1"></i>Gestión
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="contentDropdown">
                                    <li><a class="dropdown-item" href="/courses/manage/">
                                        <i class="fas fa-folder-fill me-2"></i>Mis Cursos
                                    </a></li>
                                    <li><a class="dropdown-item" href="/courses/manage/create/wizard/">
                                        <i class="fas fa-plus-circle me-2"></i>Crear Curso
                                    </a></li>
                                    <li><a class="dropdown-item" href="/courses/modules/overview/">
                                        <i class="fas fa-diagram-3 me-2"></i>Módulos
                                    </a></li>
                                </ul>
                            </li>
                            
                            
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-shield-alt me-1"></i>Admin
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                                    <li><a class="dropdown-item" href="/courses/admin/">
                                        <i class="fas fa-tachometer-alt me-2"></i>Panel Admin
                                    </a></li>
                                    <li><a class="dropdown-item" href="/courses/admin/users/">
                                        <i class="fas fa-users me-2"></i>Usuarios
                                    </a></li>
                                    <li><a class="dropdown-item" href="/courses/manage/categories/">
                                        <i class="fas fa-tags me-2"></i>Categorías
                                    </a></li>
                                </ul>
                            </li>
                            
                            
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            
            
            

            
<div class="content-manager-layout">
    <!-- Sidebar de Navegación -->
    <div class="content-sidebar">
        <!-- Sidebar de Navegación -->
<div class="sidebar-nav">
    <div class="sidebar-header">
        <h5 class="sidebar-title">
            <i class="bi bi-grid-3x3-gap me-2"></i>
            CMS
        </h5>
    </div>

    <nav class="sidebar-menu">
        <a href="#dashboard" class="sidebar-link active" data-section="dashboard">
            <i class="bi bi-house-door me-2"></i>
            Dashboard
        </a>

        <a href="/courses/content/my-blocks/" class="sidebar-link">
            <i class="bi bi-folder me-2"></i>
            Mis Bloques
            <span class="badge bg-primary ms-auto">9</span>
        </a>

        <a href="/courses/content/public/" class="sidebar-link">
            <i class="bi bi-globe me-2"></i>
            Biblioteca
        </a>

        <a href="/courses/content/featured/" class="sidebar-link">
            <i class="bi bi-star me-2"></i>
            Destacados
        </a>

        <div class="sidebar-divider"></div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Crear Bloque</div>
            <a href="#" class="sidebar-link" onclick="openCreatePanel('html')">
                <i class="bi bi-code-slash me-2"></i>
                HTML/Bootstrap
            </a>
            <a href="#" class="sidebar-link" onclick="openCreatePanel('markdown')">
                <i class="bi bi-markdown me-2"></i>
                Markdown
            </a>
            <a href="#" class="sidebar-link" onclick="openCreatePanel('json')">
                <i class="bi bi-braces me-2"></i>
                Estructurado
            </a>
            <a href="#" class="sidebar-link" onclick="openCreatePanel('text')">
                <i class="bi bi-textarea-t me-2"></i>
                Texto Simple
            </a>
            <a href="#" class="sidebar-link" onclick="showCreateOptions()">
                <i class="bi bi-plus-circle me-2"></i>
                Más tipos...
            </a>
        </div>

        <div class="sidebar-divider"></div>

        <a href="/courses/dashboard/" class="sidebar-link">
            <i class="bi bi-arrow-left me-2"></i>
            Volver al Dashboard
        </a>
    </nav>
</div>
    </div>

    <!-- Contenido Principal -->
    <div class="content-main">
        <!-- Header Compacto -->
        <div class="content-header">
            <!-- Header Compacto del Gestor de Contenido -->
<div class="content-header-bar">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h2 class="mb-0">
                <i class="bi bi-grid-3x3-gap me-2 text-primary"></i>
                Gestor de Contenido
            </h2>
            <p class="text-muted mb-0 small">Sistema de gestión de bloques reutilizables</p>
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-primary btn-sm" onclick="openCreatePanel('html')">
                <i class="bi bi-plus-circle me-1"></i>
                Nuevo Bloque
            </button>
            <div class="dropdown">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="/courses/content/my-blocks/">
                        <i class="bi bi-folder me-2"></i>Ver todos mis bloques
                    </a></li>
                    <li><a class="dropdown-item" href="/courses/content/public/">
                        <i class="bi bi-globe me-2"></i>Biblioteca pública
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" onclick="exportBlocks()">
                        <i class="bi bi-download me-2"></i>Exportar bloques
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
        </div>

        <!-- Dashboard Principal -->
        <div class="content-dashboard">
            <!-- Estadísticas Rápidas -->
            <div class="stats-overview">
                <!-- Estadísticas del CMS -->
<div class="cms-stats">
    <div class="row text-center">
        <div class="col-md-3 col-6 mb-3">
            <div class="stats-number">10</div>
            <div class="stats-label">Total de Bloques</div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="stats-number">9</div>
            <div class="stats-label">Mis Bloques</div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="stats-number">7</div>
            <div class="stats-label">Destacados</div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="stats-number">10</div>
            <div class="stats-label">Categorías</div>
        </div>
    </div>
</div>
            </div>

            <!-- Acciones Rápidas -->
            <div class="quick-actions">
                <!-- Acciones Rápidas -->
<div class="quick-actions-section">
    <h5 class="section-title">
        <i class="bi bi-lightning-charge me-2 text-warning"></i>
        Acciones Rápidas
    </h5>

    <div class="quick-actions-grid">
        <button class="quick-action-btn" onclick="openCreatePanel('html')" title="Crear bloque HTML">
            <div class="action-icon bg-primary">
                <i class="bi bi-code-slash"></i>
            </div>
            <div class="action-text">HTML</div>
        </button>

        <button class="quick-action-btn" onclick="openCreatePanel('markdown')" title="Crear bloque Markdown">
            <div class="action-icon bg-success">
                <i class="bi bi-markdown"></i>
            </div>
            <div class="action-text">Markdown</div>
        </button>

        <button class="quick-action-btn" onclick="openCreatePanel('json')" title="Crear bloque estructurado">
            <div class="action-icon bg-warning">
                <i class="bi bi-braces"></i>
            </div>
            <div class="action-text">Estructurado</div>
        </button>

        <button class="quick-action-btn" onclick="openCreatePanel('image')" title="Crear bloque de imagen">
            <div class="action-icon bg-danger">
                <i class="bi bi-image"></i>
            </div>
            <div class="action-text">Imagen</div>
        </button>

        <button class="quick-action-btn" onclick="openCreatePanel('video')" title="Crear bloque de video">
            <div class="action-icon bg-info">
                <i class="bi bi-play-circle"></i>
            </div>
            <div class="action-text">Video</div>
        </button>

        <button class="quick-action-btn" onclick="showTemplates()" title="Usar plantilla">
            <div class="action-icon bg-secondary">
                <i class="bi bi-file-earmark-plus"></i>
            </div>
            <div class="action-text">Plantilla</div>
        </button>
    </div>

    <div class="mt-3">
        <button class="btn btn-outline-primary btn-sm w-100" onclick="showCreateOptions()">
            <i class="bi bi-plus-circle me-1"></i>
            Ver todas las opciones de creación
        </button>
    </div>
</div>
            </div>

            <!-- Bloques Recientes -->
            <div class="recent-blocks-section">
                <!-- Bloques Recientes -->
<div class="recent-blocks">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0">
            <i class="bi bi-clock-history me-2 text-primary"></i>
            Bloques Recientes
        </h3>
        <div class="d-flex gap-2">
            <input type="text" class="form-control form-control-sm" id="searchBlocks" placeholder="Buscar bloques..." style="width: 200px;">
            <select class="form-select form-select-sm" id="filterType" style="width: 150px;">
                <option value="">Todos los tipos</option>
                <option value="html">HTML</option>
                <option value="markdown">Markdown</option>
                <option value="json">Estructurado</option>
                <option value="text">Texto</option>
                <option value="image">Imagen</option>
                <option value="video">Video</option>
                <option value="code">Código</option>
                <option value="list">Lista</option>
                <option value="table">Tabla</option>
                <option value="card">Tarjeta</option>
                <option value="alert">Alerta</option>
                <option value="button">Botón</option>
                <option value="form">Formulario</option>
                <option value="divider">Separador</option>
                <option value="icon">Ícono</option>
                <option value="progress">Progreso</option>
                <option value="badge">Insignia</option>
                <option value="timeline">Línea de Tiempo</option>
                <option value="quote">Cita</option>
            </select>
            <select class="form-select form-select-sm" id="filterVisibility" style="width: 120px;">
                <option value="">Todos</option>
                <option value="public">Públicos</option>
                <option value="private">Privados</option>
                <option value="featured">Destacados</option>
            </select>
        </div>
    </div>

    <div class="row">
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="json" data-visibility="public">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Anuncio</div>
                    <div class="d-flex gap-1">
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>JSON Estructurado
                         • anuncio
                        • 24/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    anuncio
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('anuncio')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/anuncio/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('anuncio')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('anuncio', 'Anuncio')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="json" data-visibility="public">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Ejercicio Completo de Programación</div>
                    <div class="d-flex gap-1">
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>JSON Estructurado
                         • Programación
                        • 24/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Un ejercicio completo con múltiples elementos estructurados
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('ejercicio')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/ejercicio/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('ejercicio')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('ejercicio', 'Ejercicio Completo de Programación')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="text" data-visibility="featured">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Fórmulas Básicas de Álgebra</div>
                    <div class="d-flex gap-1">
                        
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-star-fill me-1"></i>Destacado
                        </span>
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>Texto Simple
                         • matemáticas
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Bloque de texto simple
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('formulas-basicas-de-algebra')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/formulas-basicas-de-algebra/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('formulas-basicas-de-algebra')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('formulas-basicas-de-algebra', 'Fórmulas Básicas de Álgebra')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="text" data-visibility="featured">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Operaciones con Fracciones Algebraicas</div>
                    <div class="d-flex gap-1">
                        
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-star-fill me-1"></i>Destacado
                        </span>
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>Texto Simple
                         • matemáticas
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Bloque de texto simple relacionado con matemáticas
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('operaciones-con-fracciones-algebraicas')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/operaciones-con-fracciones-algebraicas/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('operaciones-con-fracciones-algebraicas')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('operaciones-con-fracciones-algebraicas', 'Operaciones con Fracciones Algebraicas')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="text" data-visibility="featured">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Conceptos Básicos de Funciones</div>
                    <div class="d-flex gap-1">
                        
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-star-fill me-1"></i>Destacado
                        </span>
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>Texto Simple
                         • matemáticas
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Bloque de texto simple
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('conceptos-basicos-de-funciones')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/conceptos-basicos-de-funciones/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('conceptos-basicos-de-funciones')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('conceptos-basicos-de-funciones', 'Conceptos Básicos de Funciones')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="text" data-visibility="featured">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Consejos para Resolver Ecuaciones</div>
                    <div class="d-flex gap-1">
                        
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-star-fill me-1"></i>Destacado
                        </span>
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>Texto Simple
                         • matemáticas
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Bloque de texto simple relacionado con matemáticas
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('consejos-para-resolver-ecuaciones')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/consejos-para-resolver-ecuaciones/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('consejos-para-resolver-ecuaciones')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('consejos-para-resolver-ecuaciones', 'Consejos para Resolver Ecuaciones')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="json" data-visibility="public">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Glosario de Términos</div>
                    <div class="d-flex gap-1">
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>JSON Estructurado
                         • Referencia
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Definiciones importantes del curso
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('glosario-terminos')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/glosario-terminos/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('glosario-terminos')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('glosario-terminos', 'Glosario de Términos')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="html" data-visibility="featured">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Ejemplos Prácticos</div>
                    <div class="d-flex gap-1">
                        
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-star-fill me-1"></i>Destacado
                        </span>
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>HTML Personalizado
                         • Ejercicios
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Ejercicios y ejemplos aplicados
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('ejemplos-practicos')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/ejemplos-practicos/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('ejemplos-practicos')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('ejemplos-practicos', 'Ejemplos Prácticos')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="markdown" data-visibility="featured">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Conceptos Básicos de Álgebra</div>
                    <div class="d-flex gap-1">
                        
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-star-fill me-1"></i>Destacado
                        </span>
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>Markdown
                         • Conceptos Fundamentales
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Explicación de variables, constantes y expresiones
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('conceptos-basicos-algebra')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/conceptos-basicos-algebra/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('conceptos-basicos-algebra')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('conceptos-basicos-algebra', 'Conceptos Básicos de Álgebra')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 col-xl-4 mb-4">
            <div class="block-card" data-type="html" data-visibility="featured">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="block-title">Introducción a Matemáticas</div>
                    <div class="d-flex gap-1">
                        
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-star-fill me-1"></i>Destacado
                        </span>
                        
                        
                        <span class="badge bg-success">
                            <i class="bi bi-globe me-1"></i>Público
                        </span>
                        
                    </div>
                </div>

                <div class="block-meta mb-2">
                    <small class="text-muted">
                        <i class="bi bi-tag me-1"></i>HTML Personalizado
                         • Introducción
                        • 23/09/2025
                    </small>
                </div>

                
                <div class="block-description mb-3">
                    Bloque introductorio para cursos de matemáticas
                </div>
                

                <div class="block-actions">
                    <button class="btn btn-sm btn-outline-primary" onclick="previewBlock('introduccion-matematicas')">
                        <i class="bi bi-eye me-1"></i>Vista Previa
                    </button>
                    <a href="/courses/content/introduccion-matematicas/edit/" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <button class="btn btn-sm btn-outline-info" onclick="duplicateBlock('introduccion-matematicas')">
                        <i class="bi bi-copy me-1"></i>Duplicar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteBlock('introduccion-matematicas', 'Introducción a Matemáticas')">
                        <i class="bi bi-trash me-1"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
        
    </div>
</div>
            </div>
        </div>
    </div>

    <!-- Panel Lateral Derecho (Crear Bloque) -->
    <div class="content-panel" id="createPanel">
        <!-- Panel Lateral para Crear Bloques -->
<div class="create-panel">
    <div class="panel-header">
        <h6 class="panel-title">
            <i class="bi bi-plus-circle me-2"></i>
            Crear Nuevo Bloque
        </h6>
        <button class="btn-close" onclick="closeCreatePanel()" aria-label="Cerrar"></button>
    </div>

    <div class="panel-content">
        <!-- Selector de Tipo -->
        <div class="mb-3">
            <label class="form-label">Tipo de Contenido</label>
            <select class="form-select" id="panelContentType" onchange="changePanelContentType()">
                <option value="">Seleccionar tipo...</option>
                <option value="html">HTML/Bootstrap</option>
                <option value="markdown">Markdown</option>
                <option value="json">Estructurado JSON</option>
                <option value="text">Texto Simple</option>
                <option value="image">Imagen</option>
                <option value="video">Video</option>
                <option value="code">Código</option>
                <option value="list">Lista</option>
                <option value="table">Tabla</option>
                <option value="card">Tarjeta</option>
                <option value="alert">Alerta</option>
                <option value="button">Botón</option>
                <option value="form">Formulario</option>
                <option value="quote">Cita</option>
                <option value="divider">Separador</option>
                <option value="icon">Ícono</option>
                <option value="progress">Barra de Progreso</option>
                <option value="badge">Insignia</option>
                <option value="timeline">Línea de Tiempo</option>
            </select>
        </div>

        <!-- Formulario de Creación -->
        <form id="panelCreateForm" method="post" action="/courses/content/create/" style="display: none;">
            <input type="hidden" name="csrfmiddlewaretoken" value="9WvBfn1Y3M8ClhE7Zv3c7HYEuWfv2xx9c2EWcFtjgbbACfNBhTRrnPU8UxaNfWOx">
            <input type="hidden" name="block_type" id="panelBlockType">

            <!-- Campos Básicos -->
            <div class="mb-3">
                <label class="form-label">Título *</label>
                <input type="text" class="form-control" name="title" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Descripción</label>
                <textarea class="form-control" name="description" rows="2"></textarea>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Categoría</label>
                    <input type="text" class="form-control" name="category" placeholder="ej: Introducción, Avanzado">
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Etiquetas</label>
                    <input type="text" class="form-control" name="tags" placeholder="separadas por coma">
                </div>
            </div>

            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="is_public" id="panelIsPublic">
                    <label class="form-check-label" for="panelIsPublic">
                        Bloque público (visible para otros tutores)
                    </label>
                </div>
            </div>

            <!-- Campos Dinámicos por Tipo -->
            <div id="panelDynamicFields"></div>

            <!-- Botones de Acción -->
            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-circle me-1"></i>
                    Crear Bloque
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="closeCreatePanel()">
                    <i class="bi bi-x-circle me-1"></i>
                    Cancelar
                </button>
            </div>
        </form>

        <!-- Mensaje Inicial -->
        <div id="panelInitialMessage" class="text-center py-4">
            <i class="bi bi-arrow-up-circle fs-1 text-muted mb-3"></i>
            <p class="text-muted">Selecciona un tipo de contenido para comenzar</p>
        </div>
    </div>
</div>
    </div>

    <!-- Modal de Vista Previa -->
    <!-- Modal de Vista Previa -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-eye me-2"></i>
                    Vista Previa del Bloque
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="previewContent">
                    <!-- El contenido se cargará aquí -->
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2 text-muted">Cargando vista previa...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>
                    Cerrar
                </button>
            </div>
        </div>
    </div>
</div>
</div>
<script>
// Variables globales
let selectedContentType = '';
let currentPanelType = '';

// Función para seleccionar tipo de contenido
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.content-type-card').forEach(card => {
        card.addEventListener('click', function() {
            // Remover selección anterior
            document.querySelectorAll('.content-type-card').forEach(c => c.classList.remove('selected'));
            // Seleccionar este
            this.classList.add('selected');

            selectedContentType = this.dataset.type;
            document.getElementById('selectedContentType').value = selectedContentType;
            document.getElementById('createButton').disabled = false;

            // Mostrar campos específicos
            showContentFields(selectedContentType);
        });
    });
});

// Función para mostrar campos específicos según el tipo
function showContentFields(contentType) {
    const contentFields = document.getElementById('contentFields');
    const dynamicFields = document.getElementById('dynamicFields');
    const sectionTitle = document.getElementById('contentSectionTitle');

    contentFields.style.display = 'block';

    let fieldsHtml = '';

    switch(contentType) {
        case 'html':
        case 'bootstrap':
            sectionTitle.innerHTML = '<i class="bi bi-code-slash text-primary"></i> Código HTML/Bootstrap';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Código HTML/Bootstrap *</label>
                    <textarea class="form-control" name="html_content" rows="10" placeholder="Ingresa tu código HTML o Bootstrap aquí..." required></textarea>
                    <div class="form-text">Puedes incluir clases de Bootstrap y estilos personalizados</div>
                </div>
            `;
            break;

        case 'markdown':
            sectionTitle.innerHTML = '<i class="bi bi-markdown text-success"></i> Contenido Markdown';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Contenido Markdown *</label>
                    <textarea class="form-control" name="markdown_content" rows="10" placeholder="# Título Principal\n\nEste es un **texto en negrita** y este es *itálico*.\n\n- Elemento de lista 1\n- Elemento de lista 2\n\n\`\`\`python\nprint('Hola Mundo')\n\`\`\`" required></textarea>
                    <div class="form-text">Soporta encabezados, listas, código, enlaces, imágenes, etc.</div>
                </div>
            `;
            break;

        case 'json':
            sectionTitle.innerHTML = '<i class="bi bi-braces text-warning"></i> Contenido Estructurado JSON';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Elementos Estructurados (JSON)</label>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Este tipo permite crear contenido complejo con múltiples elementos estructurados para lecciones.
                    </div>
                    <div class="text-end mb-2">
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="addStructuredElement()">
                            <i class="bi bi-plus-circle me-1"></i>Agregar Elemento
                        </button>
                    </div>
                    <div id="structuredElements" class="border rounded p-3" style="min-height: 200px;">
                        <!-- Los elementos se agregarán aquí dinámicamente -->
                        <p class="text-muted text-center">Haz clic en "Agregar Elemento" para comenzar</p>
                    </div>
                </div>
            `;
            break;

        case 'text':
            sectionTitle.innerHTML = '<i class="bi bi-textarea-t text-info"></i> Texto Simple';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Contenido de Texto *</label>
                    <textarea class="form-control" name="text_content" rows="6" placeholder="Ingresa el contenido de texto aquí..." required></textarea>
                </div>
            `;
            break;

        case 'image':
            sectionTitle.innerHTML = '<i class="bi bi-image text-danger"></i> Imagen';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">URL de la Imagen *</label>
                        <input type="url" class="form-control" name="image_url" placeholder="https://ejemplo.com/imagen.jpg" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Texto Alternativo</label>
                        <input type="text" class="form-control" name="image_alt" placeholder="Descripción de la imagen">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Pie de Foto</label>
                    <input type="text" class="form-control" name="image_caption" placeholder="Texto que aparece debajo de la imagen">
                </div>
            `;
            break;

        case 'video':
            sectionTitle.innerHTML = '<i class="bi bi-play-circle text-success"></i> Video';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">URL del Video *</label>
                    <input type="url" class="form-control" name="video_url" placeholder="https://www.youtube.com/watch?v=..." required>
                    <div class="form-text">Soporta YouTube, Vimeo y URLs directas de video</div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Descripción</label>
                        <input type="text" class="form-control" name="video_description" placeholder="Breve descripción del video">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Duración (minutos)</label>
                        <input type="number" class="form-control" name="video_duration" min="1" placeholder="15">
                    </div>
                </div>
            `;
            break;

        case 'quote':
            sectionTitle.innerHTML = '<i class="bi bi-quote text-secondary"></i> Cita';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Texto de la Cita *</label>
                    <textarea class="form-control" name="quote_text" rows="3" placeholder="La educación es el arma más poderosa..." required></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Autor de la Cita</label>
                    <input type="text" class="form-control" name="quote_author" placeholder="Nelson Mandela">
                </div>
            `;
            break;

        case 'code':
            sectionTitle.innerHTML = '<i class="bi bi-terminal text-dark"></i> Código';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Lenguaje de Programación *</label>
                        <select class="form-select" name="code_language" required>
                            <option value="text">Texto Plano</option>
                            <option value="python">Python</option>
                            <option value="javascript">JavaScript</option>
                            <option value="html">HTML</option>
                            <option value="css">CSS</option>
                            <option value="java">Java</option>
                            <option value="cpp">C++</option>
                            <option value="c">C</option>
                            <option value="php">PHP</option>
                            <option value="ruby">Ruby</option>
                            <option value="sql">SQL</option>
                            <option value="bash">Bash</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Título del Código</label>
                        <input type="text" class="form-control" name="code_title" placeholder="Ejemplo de función">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Código Fuente *</label>
                    <textarea class="form-control font-monospace" name="code_content" rows="8" placeholder="def hello_world():\n    print('Hello, World!')" required></textarea>
                </div>
            `;
            break;

        case 'list':
            sectionTitle.innerHTML = '<i class="bi bi-list-ul text-primary"></i> Lista';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Tipo de Lista *</label>
                    <select class="form-select" name="list_type" required>
                        <option value="unordered">Lista No Ordenada</option>
                        <option value="ordered">Lista Ordenada</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Elementos de la Lista *</label>
                    <textarea class="form-control" name="list_items" rows="6" placeholder="Elemento 1&#10;Elemento 2&#10;Elemento 3" required></textarea>
                    <div class="form-text">Cada línea representa un elemento de la lista</div>
                </div>
            `;
            break;

        case 'table':
            sectionTitle.innerHTML = '<i class="bi bi-table text-info"></i> Tabla';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Encabezados (separados por coma) *</label>
                    <input type="text" class="form-control" name="table_headers" placeholder="Nombre, Edad, Ciudad" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Filas de Datos *</label>
                    <textarea class="form-control" name="table_rows" rows="6" placeholder="Juan, 25, Madrid&#10;María, 30, Barcelona&#10;Pedro, 35, Valencia" required></textarea>
                    <div class="form-text">Cada línea es una fila, valores separados por coma</div>
                </div>
            `;
            break;

        case 'card':
            sectionTitle.innerHTML = '<i class="bi bi-card-text text-warning"></i> Tarjeta';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Título de la Tarjeta *</label>
                        <input type="text" class="form-control" name="card_title" placeholder="Título principal" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Texto de la Tarjeta *</label>
                        <textarea class="form-control" name="card_text" rows="2" placeholder="Contenido de la tarjeta" required></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">URL del Botón</label>
                        <input type="url" class="form-control" name="card_button_url" placeholder="https://ejemplo.com">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Texto del Botón</label>
                        <input type="text" class="form-control" name="card_button_text" placeholder="Ver más" value="Ver más">
                    </div>
                </div>
            `;
            break;

        case 'alert':
            sectionTitle.innerHTML = '<i class="bi bi-exclamation-triangle text-warning"></i> Alerta';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Tipo de Alerta *</label>
                        <select class="form-select" name="alert_type" required>
                            <option value="primary">Primario</option>
                            <option value="secondary">Secundario</option>
                            <option value="success">Éxito</option>
                            <option value="danger">Peligro</option>
                            <option value="warning">Advertencia</option>
                            <option value="info">Información</option>
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Mensaje de Alerta *</label>
                        <input type="text" class="form-control" name="alert_message" placeholder="Texto del mensaje de alerta" required>
                    </div>
                </div>
            `;
            break;

        case 'button':
            sectionTitle.innerHTML = '<i class="bi bi-hand-index-thumb text-info"></i> Botón';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Texto del Botón *</label>
                        <input type="text" class="form-control" name="button_text" placeholder="Haz clic aquí" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">URL del Botón *</label>
                        <input type="url" class="form-control" name="button_url" placeholder="https://ejemplo.com" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Estilo del Botón</label>
                        <select class="form-select" name="button_style">
                            <option value="primary">Primario</option>
                            <option value="secondary">Secundario</option>
                            <option value="success">Éxito</option>
                            <option value="danger">Peligro</option>
                            <option value="warning">Advertencia</option>
                            <option value="info">Información</option>
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Tamaño del Botón</label>
                        <select class="form-select" name="button_size">
                            <option value="sm">Pequeño</option>
                            <option value="md" selected>Mediano</option>
                            <option value="lg">Grande</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ícono (opcional)</label>
                        <input type="text" class="form-control" name="button_icon" placeholder="bi-star, bi-heart, etc.">
                        <div class="form-text">Nombre del ícono de Bootstrap Icons</div>
                    </div>
                </div>
            `;
            break;

        case 'form':
            sectionTitle.innerHTML = '<i class="bi bi-ui-checks text-success"></i> Formulario';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">URL de Acción del Formulario *</label>
                    <input type="url" class="form-control" name="form_action" placeholder="/procesar-formulario" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Campos del Formulario (JSON)</label>
                    <textarea class="form-control font-monospace" name="form_fields" rows="8" placeholder='[
  {"type": "text", "name": "nombre", "label": "Nombre", "required": true},
  {"type": "email", "name": "email", "label": "Correo Electrónico", "required": true},
  {"type": "textarea", "name": "mensaje", "label": "Mensaje", "placeholder": "Escribe tu mensaje aquí"}
]'></textarea>
                    <div class="form-text">Define los campos del formulario en formato JSON</div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Texto del Botón de Envío</label>
                    <input type="text" class="form-control" name="form_submit_text" placeholder="Enviar" value="Enviar">
                </div>
            `;
            break;

        case 'divider':
            sectionTitle.innerHTML = '<i class="bi bi-dash text-muted"></i> Separador';
            fieldsHtml = `
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    El separador es un elemento visual simple que no requiere configuración adicional.
                </div>
            `;
            break;

        case 'icon':
            sectionTitle.innerHTML = '<i class="bi bi-star text-warning"></i> Ícono';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ícono *</label>
                        <input type="text" class="form-control" name="icon_name" placeholder="star" required>
                        <div class="form-text">Nombre del ícono de Bootstrap Icons (sin "bi-")</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Color</label>
                        <select class="form-select" name="icon_color">
                            <option value="primary">Primario</option>
                            <option value="secondary">Secundario</option>
                            <option value="success">Éxito</option>
                            <option value="danger">Peligro</option>
                            <option value="warning">Advertencia</option>
                            <option value="info">Información</option>
                            <option value="dark">Oscuro</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Texto Adicional</label>
                        <input type="text" class="form-control" name="icon_text" placeholder="Texto opcional junto al ícono">
                    </div>
                </div>
            `;
            break;

        case 'progress':
            sectionTitle.innerHTML = '<i class="bi bi-bar-chart text-success"></i> Barra de Progreso';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Valor del Progreso (0-100) *</label>
                        <input type="number" class="form-control" name="progress_value" min="0" max="100" value="50" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Color de la Barra</label>
                        <select class="form-select" name="progress_color">
                            <option value="primary">Primario</option>
                            <option value="secondary">Secundario</option>
                            <option value="success">Éxito</option>
                            <option value="danger">Peligro</option>
                            <option value="warning">Advertencia</option>
                            <option value="info">Información</option>
                            <option value="dark">Oscuro</option>
                        </select>
                    </div>
                </div>
            `;
            break;

        case 'badge':
            sectionTitle.innerHTML = '<i class="bi bi-tag text-info"></i> Insignia';
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Texto de la Insignia *</label>
                        <input type="text" class="form-control" name="badge_text" placeholder="Nuevo" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Color de la Insignia</label>
                        <select class="form-select" name="badge_color">
                            <option value="primary">Primario</option>
                            <option value="secondary">Secundario</option>
                            <option value="success">Éxito</option>
                            <option value="danger">Peligro</option>
                            <option value="warning">Advertencia</option>
                            <option value="info">Información</option>
                            <option value="dark">Oscuro</option>
                        </select>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Ícono (opcional)</label>
                    <input type="text" class="form-control" name="badge_icon" placeholder="bi-star">
                    <div class="form-text">Nombre del ícono de Bootstrap Icons</div>
                </div>
            `;
            break;

        case 'timeline':
            sectionTitle.innerHTML = '<i class="bi bi-timeline text-primary"></i> Línea de Tiempo';
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Elementos de la Línea de Tiempo (JSON)</label>
                    <textarea class="form-control font-monospace" name="timeline_items" rows="8" placeholder='[
  {"title": "Evento 1", "description": "Descripción del primer evento", "date": "2024-01-01", "color": "primary"},
  {"title": "Evento 2", "description": "Descripción del segundo evento", "date": "2024-02-01", "color": "success"}
]'></textarea>
                    <div class="form-text">Define los elementos de la línea de tiempo en formato JSON</div>
                </div>
            `;
            break;

        default:
            fieldsHtml = `
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Tipo de contenido no reconocido. Los campos se cargarán dinámicamente.
                </div>
            `;
    }

    dynamicFields.innerHTML = fieldsHtml;
}

// Función para agregar elementos estructurados (para tipo JSON)
function addStructuredElement() {
    const container = document.getElementById('structuredElements');
    const elementCount = container.querySelectorAll('.structured-element').length;

    const elementHtml = `
        <div class="structured-element border rounded p-3 mb-3" data-index="${elementCount}">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Elemento ${elementCount + 1}</h6>
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeStructuredElement(this)">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Tipo de Elemento</label>
                    <select class="form-select element-type" name="structured_elements[${elementCount}][type]" onchange="updateElementFields(this)">
                        <option value="heading">Encabezado</option>
                        <option value="text">Texto</option>
                        <option value="list">Lista</option>
                        <option value="image">Imagen</option>
                        <option value="video">Video</option>
                        <option value="code">Código</option>
                        <option value="exercise">Ejercicio</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Título (opcional)</label>
                    <input type="text" class="form-control" name="structured_elements[${elementCount}][title]" placeholder="Título del elemento">
                </div>
            </div>
            <div class="element-fields">
                <!-- Los campos específicos se cargarán aquí -->
            </div>
        </div>
    `;

    if (elementCount === 0) {
        container.innerHTML = '';
    }

    container.insertAdjacentHTML('beforeend', elementHtml);

    // Inicializar campos para el primer elemento
    const firstElement = container.lastElementChild;
    const typeSelect = firstElement.querySelector('.element-type');
    updateElementFields(typeSelect);
}

function removeStructuredElement(button) {
    button.closest('.structured-element').remove();

    // Reordenar índices si es necesario
    const elements = document.querySelectorAll('.structured-element');
    elements.forEach((el, index) => {
        el.dataset.index = index;
        el.querySelector('h6').textContent = `Elemento ${index + 1}`;

        // Actualizar nombres de campos
        const inputs = el.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.name) {
                input.name = input.name.replace(/\[\d+\]/, `[${index}]`);
            }
        });
    });
}

function updateElementFields(select) {
    const elementDiv = select.closest('.structured-element');
    const fieldsContainer = elementDiv.querySelector('.element-fields');
    const elementIndex = elementDiv.dataset.index;
    const elementType = select.value;

    let fieldsHtml = '';

    switch(elementType) {
        case 'heading':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nivel del Encabezado</label>
                        <select class="form-select" name="structured_elements[${elementIndex}][level]">
                            <option value="1">H1</option>
                            <option value="2">H2</option>
                            <option value="3">H3</option>
                            <option value="4">H4</option>
                            <option value="5">H5</option>
                            <option value="6">H6</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Texto del Encabezado *</label>
                        <input type="text" class="form-control" name="structured_elements[${elementIndex}][content]" required>
                    </div>
                </div>
            `;
            break;

        case 'text':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Contenido de Texto *</label>
                    <textarea class="form-control" name="structured_elements[${elementIndex}][content]" rows="4" required></textarea>
                </div>
            `;
            break;

        case 'list':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Tipo de Lista</label>
                    <select class="form-select" name="structured_elements[${elementIndex}][ordered]">
                        <option value="false">Lista No Ordenada</option>
                        <option value="true">Lista Ordenada</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Elementos de la Lista *</label>
                    <textarea class="form-control" name="structured_elements[${elementIndex}][items]" rows="4" placeholder="Elemento 1&#10;Elemento 2&#10;Elemento 3" required></textarea>
                    <div class="form-text">Cada línea representa un elemento de la lista</div>
                </div>
            `;
            break;

        case 'image':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">URL de la Imagen *</label>
                    <input type="url" class="form-control" name="structured_elements[${elementIndex}][content]" required>
                </div>
            `;
            break;

        case 'video':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">URL del Video *</label>
                    <input type="url" class="form-control" name="structured_elements[${elementIndex}][content]" required>
                </div>
            `;
            break;

        case 'code':
            fieldsHtml = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Lenguaje</label>
                        <input type="text" class="form-control" name="structured_elements[${elementIndex}][language]" placeholder="python">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Código *</label>
                        <textarea class="form-control font-monospace" name="structured_elements[${elementIndex}][code]" rows="6" required></textarea>
                    </div>
                </div>
            `;
            break;

        case 'exercise':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Descripción del Ejercicio *</label>
                    <textarea class="form-control" name="structured_elements[${elementIndex}][content]" rows="4" required></textarea>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Dificultad</label>
                        <select class="form-select" name="structured_elements[${elementIndex}][difficulty]">
                            <option value="beginner">Principiante</option>
                            <option value="intermediate">Intermedio</option>
                            <option value="advanced">Avanzado</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Tiempo Estimado (min)</label>
                        <input type="number" class="form-control" name="structured_elements[${elementIndex}][estimated_time]" min="1">
                    </div>
                </div>
            `;
            break;
    }

    fieldsContainer.innerHTML = fieldsHtml;
}

// Funciones para gestionar bloques
function previewBlock(slug) {
    fetch(`/courses/content/${slug}/preview/`)
        .then(response => response.text())
        .then(html => {
            document.getElementById('previewContent').innerHTML = html;
            new bootstrap.Modal(document.getElementById('previewModal')).show();
        })
        .catch(error => {
            console.error('Error loading preview:', error);
            document.getElementById('previewContent').innerHTML = '<div class="alert alert-danger">Error al cargar la vista previa</div>';
            new bootstrap.Modal(document.getElementById('previewModal')).show();
        });
}

function duplicateBlock(slug) {
    if (confirm('¿Estás seguro de que quieres duplicar este bloque?')) {
        fetch(`/courses/content/${slug}/duplicate/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Error al duplicar el bloque');
            }
        });
    }
}

function deleteBlock(slug, title) {
    if (confirm(`¿Estás seguro de que quieres eliminar el bloque "${title}"?`)) {
        fetch(`/courses/content/${slug}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Error al eliminar el bloque');
            }
        });
    }
}

// Filtros de búsqueda (si existen)
const searchInput = document.getElementById('searchBlocks');
const typeFilter = document.getElementById('filterType');
const visibilityFilter = document.getElementById('filterVisibility');

if (searchInput) searchInput.addEventListener('input', filterBlocks);
if (typeFilter) typeFilter.addEventListener('change', filterBlocks);
if (visibilityFilter) visibilityFilter.addEventListener('change', filterBlocks);

function filterBlocks() {
    const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
    const typeFilterValue = typeFilter ? typeFilter.value : '';
    const visibilityFilterValue = visibilityFilter ? visibilityFilter.value : '';

    const blocks = document.querySelectorAll('.block-card');

    blocks.forEach(block => {
        const title = block.querySelector('.block-title').textContent.toLowerCase();
        const type = block.dataset.type;
        const visibility = block.dataset.visibility;

        const matchesSearch = title.includes(searchTerm);
        const matchesType = !typeFilterValue || type === typeFilterValue;
        const matchesVisibility = !visibilityFilterValue || visibility === visibilityFilterValue;

        if (matchesSearch && matchesType && matchesVisibility) {
            block.style.display = '';
        } else {
            block.style.display = 'none';
        }
    });
}

// Procesar envío del formulario principal
document.getElementById('createBlockForm').addEventListener('submit', function(e) {
    e.preventDefault();

    // Validar que se haya seleccionado un tipo de contenido
    if (!selectedContentType) {
        alert('Por favor selecciona un tipo de contenido');
        return;
    }

    const formData = new FormData(this);

    // Procesar elementos estructurados si existen
    if (selectedContentType === 'json') {
        const structuredElements = [];
        const elementDivs = document.querySelectorAll('.structured-element');

        elementDivs.forEach((elementDiv, index) => {
            const elementData = {
                type: elementDiv.querySelector('.element-type').value,
                title: elementDiv.querySelector(`input[name="structured_elements[${index}][title]"]`)?.value || '',
            };

            // Agregar campos específicos según el tipo
            const type = elementData.type;
            switch(type) {
                case 'heading':
                    elementData.level = elementDiv.querySelector(`select[name="structured_elements[${index}][level]"]`).value;
                    elementData.content = elementDiv.querySelector(`input[name="structured_elements[${index}][content]"]`).value;
                    break;
                case 'text':
                    elementData.content = elementDiv.querySelector(`textarea[name="structured_elements[${index}][content]"]`).value;
                    break;
                case 'list':
                    elementData.ordered = elementDiv.querySelector(`select[name="structured_elements[${index}][ordered]"]`).value;
                    elementData.items = elementDiv.querySelector(`textarea[name="structured_elements[${index}][items]"]`).value.split('\n').filter(item => item.trim());
                    break;
                case 'image':
                    elementData.content = elementDiv.querySelector(`input[name="structured_elements[${index}][content]"]`).value;
                    break;
                case 'video':
                    elementData.content = elementDiv.querySelector(`input[name="structured_elements[${index}][content]"]`).value;
                    break;
                case 'code':
                    elementData.language = elementDiv.querySelector(`input[name="structured_elements[${index}][language]"]`).value;
                    elementData.code = elementDiv.querySelector(`textarea[name="structured_elements[${index}][code]"]`).value;
                    break;
                case 'exercise':
                    elementData.content = elementDiv.querySelector(`textarea[name="structured_elements[${index}][content]"]`).value;
                    elementData.difficulty = elementDiv.querySelector(`select[name="structured_elements[${index}][difficulty]"]`).value;
                    elementData.estimated_time = elementDiv.querySelector(`input[name="structured_elements[${index}][estimated_time]"]`).value;
                    break;
            }

            structuredElements.push(elementData);
        });

        formData.set('json_content', JSON.stringify(structuredElements));
    }

    // Mostrar indicador de carga
    const submitButton = document.getElementById('createButton');
    const originalText = submitButton.innerHTML;
    submitButton.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>Creando...';
    submitButton.disabled = true;

    fetch(`/courses/content/create/${selectedContentType}/`, {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            // Recargar la página para mostrar el nuevo bloque
            location.reload();
        } else {
            return response.json().then(data => {
                if (data.errors) {
                    // Mostrar errores de validación
                    let errorMessage = 'Errores de validación:\n';
                    for (const [field, messages] of Object.entries(data.errors)) {
                        errorMessage += `${field}: ${messages.join(', ')}\n`;
                    }
                    alert(errorMessage);
                } else {
                    alert('Error al crear el bloque');
                }
            });
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error de conexión al crear el bloque');
    })
    .finally(() => {
        // Restaurar el botón
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
    });
});

// ===========================================
// FUNCIONES PARA EL NUEVO LAYOUT REORGANIZADO
// ===========================================

// Abrir panel de creación con tipo específico
function openCreatePanel(type) {
    currentPanelType = type;
    document.getElementById('panelContentType').value = type;
    document.getElementById('panelBlockType').value = type;
    document.getElementById('createPanel').classList.add('open');
    changePanelContentType();
}

// Cerrar panel de creación
function closeCreatePanel() {
    document.getElementById('createPanel').classList.remove('open');
    document.getElementById('panelCreateForm').style.display = 'none';
    document.getElementById('panelInitialMessage').style.display = 'block';
    document.getElementById('panelCreateForm').reset();
    currentPanelType = '';
}

// Cambiar tipo de contenido en el panel
function changePanelContentType() {
    const select = document.getElementById('panelContentType');
    const type = select.value;

    if (!type) {
        document.getElementById('panelCreateForm').style.display = 'none';
        document.getElementById('panelInitialMessage').style.display = 'block';
        return;
    }

    currentPanelType = type;
    document.getElementById('panelBlockType').value = type;
    document.getElementById('panelCreateForm').style.display = 'block';
    document.getElementById('panelInitialMessage').style.display = 'none';

    // Generar campos dinámicos según el tipo
    generatePanelFields(type);
}

// Generar campos dinámicos para el panel
function generatePanelFields(contentType) {
    const container = document.getElementById('panelDynamicFields');
    let fieldsHtml = '';

    switch(contentType) {
        case 'html':
        case 'bootstrap':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Código HTML/Bootstrap *</label>
                    <textarea class="form-control" name="html_content" rows="6" placeholder="Ingresa tu código HTML o Bootstrap aquí..." required></textarea>
                </div>
            `;
            break;

        case 'markdown':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Contenido Markdown *</label>
                    <textarea class="form-control" name="markdown_content" rows="6" placeholder="# Título\n\nContenido en **Markdown**..." required></textarea>
                </div>
            `;
            break;

        case 'json':
            fieldsHtml = `
                <div class="alert alert-info mb-3">
                    <small>Para contenido estructurado complejo, usa el formulario completo.</small>
                </div>
                <div class="mb-3">
                    <label class="form-label">JSON (opcional)</label>
                    <textarea class="form-control font-monospace" name="json_content" rows="4" placeholder='{}'></textarea>
                </div>
            `;
            break;

        case 'text':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">Contenido de Texto *</label>
                    <textarea class="form-control" name="text_content" rows="4" placeholder="Ingresa el contenido de texto aquí..." required></textarea>
                </div>
            `;
            break;

        case 'image':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">URL de la Imagen *</label>
                    <input type="url" class="form-control" name="image_url" placeholder="https://ejemplo.com/imagen.jpg" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Texto Alternativo</label>
                    <input type="text" class="form-control" name="image_alt" placeholder="Descripción de la imagen">
                </div>
            `;
            break;

        case 'video':
            fieldsHtml = `
                <div class="mb-3">
                    <label class="form-label">URL del Video *</label>
                    <input type="url" class="form-control" name="video_url" placeholder="https://www.youtube.com/watch?v=..." required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Descripción</label>
                    <input type="text" class="form-control" name="video_description" placeholder="Breve descripción del video">
                </div>
            `;
            break;

        default:
            fieldsHtml = `
                <div class="alert alert-info">
                    <small>Para este tipo de contenido, usa el formulario completo para más opciones.</small>
                </div>
            `;
    }

    container.innerHTML = fieldsHtml;
}

// Mostrar opciones adicionales de creación
function showCreateOptions() {
    // Por ahora, redirigir al formulario completo
    window.location.href = "/courses/content/create/";
}

// Mostrar plantillas disponibles
function showTemplates() {
    alert('Funcionalidad de plantillas próximamente disponible');
}

// Exportar bloques
function exportBlocks() {
    alert('Funcionalidad de exportación próximamente disponible');
}

// Navegación de sidebar
document.addEventListener('DOMContentLoaded', function() {
    // Manejar navegación de sidebar
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.addEventListener('click', function(e) {
            // Remover clase active de todos
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            // Agregar clase active al actual
            this.classList.add('active');
        });
    });

    // Cerrar panel al hacer clic fuera
    document.addEventListener('click', function(e) {
        const panel = document.getElementById('createPanel');
        const panelContent = panel.querySelector('.panel-content');

        if (panel.classList.contains('open') &&
            !panel.contains(e.target) &&
            !e.target.closest('.quick-action-btn') &&
            !e.target.closest('[onclick*="openCreatePanel"]')) {
            closeCreatePanel();
        }
    });

    // Procesar envío del formulario del panel
    document.getElementById('panelCreateForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(this);

        // Mostrar indicador de carga
        const submitButton = this.querySelector('button[type="submit"]');
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>Creando...';
        submitButton.disabled = true;

        fetch(`/courses/content/create/${currentPanelType}/`, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // Cerrar panel y recargar la página
                closeCreatePanel();
                location.reload();
            } else {
                return response.json().then(data => {
                    if (data.errors) {
                        let errorMessage = 'Errores de validación:\n';
                        for (const [field, messages] of Object.entries(data.errors)) {
                            errorMessage += `${field}: ${messages.join(', ')}\n`;
                        }
                        alert(errorMessage);
                    } else {
                        alert('Error al crear el bloque');
                    }
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error de conexión al crear el bloque');
        })
        .finally(() => {
            // Restaurar el botón
            submitButton.innerHTML = originalText;
            submitButton.disabled = false;
        });
    });
});
</script>


        </div>
    </div>
</div>

<style>
/* Estilos para la barra de navegación superior */
.navbar {
    border: 1px solid #dee2e6;
}

.navbar-nav .nav-link {
    color: #495057 !important;
    font-weight: 500;
    padding: 0.75rem 1rem;
    transition: color 0.15s ease-in-out;
}

.navbar-nav .nav-link:hover {
    color: #0d6efd !important;
}

.navbar-nav .nav-link i {
    width: 16px;
    text-align: center;
}

.dropdown-menu {
    border: 1px solid #dee2e6;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

.dropdown-item {
    padding: 0.5rem 1.5rem;
    transition: background-color 0.15s ease-in-out;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.dropdown-item i {
    width: 16px;
    text-align: center;
}

/* Responsive adjustments */
@media (max-width: 991.98px) {
    .navbar-collapse {
        background-color: #f8f9fa;
        border-radius: 0.375rem;
        margin-top: 0.5rem;
        padding: 0.5rem 0;
    }

    .navbar-nav .nav-link {
        padding: 0.5rem 1rem;
    }
}

/* Active state for current page */
.navbar-nav .nav-link.active {
    color: #0d6efd !important;
    font-weight: 600;
}
</style>


            
            
                
<!-- Panel flotante de chat para incluir en base.html -->
<!-- Botón flotante para restaurar chat -->
<button id="chat-restore-btn" class="btn btn-primary rounded-circle d-flex align-items-center justify-content-center" style="display:none;">
    <i class="bi bi-chat-dots"></i>
</button>

<div id="chat-panel" class="docked card">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center chat-header">
        <span>
            <i class="bi bi-chat-dots me-2"></i>Chat
            <select id="chat-room-selector" class="form-select form-select-sm d-inline-block w-auto ms-2">
                <option value="" disabled selected>Selecciona una sala...</option>
            </select>
        </span>
        <div class="d-flex gap-1">
            <button id="go-chat-main-btn" class="btn btn-light btn-sm" title="Ir al chat principal">
                <i class="bi bi-box-arrow-up-right"></i>
            </button>
            <button id="toggle-dock-btn" class="btn btn-light btn-sm" title="Acoplar/desacoplar">
                <i class="bi bi-layout-sidebar-inset"></i>
            </button>
            <button id="toggle-chat-panel" class="btn btn-link text-white p-0" style="font-size:1.5rem; line-height:1;">
                &#8211;
            </button>
        </div>
    </div>

    <div id="chat-panel-body" class="chat-panel-body">
        <div id="chat-log">
            <div class="d-flex mb-2 justify-content-end">
                <div class="message-bubble outgoing">
                    <div class="small fw-bold mb-1">You</div>
                    <div class="message-content">¡Bienvenido al chat!</div>
                    <div class="message-time small mt-1 text-muted">Ahora</div>
                </div>
            </div>
            <div id="typing-indicator" class="typing-indicator">
                <span></span><span></span><span></span> escribiendo...
            </div>
        </div>
    </div>

    <div class="chat-info-containers d-flex flex-column">
        <div class="input-group">
            <input id="chat-message-input" type="text" class="form-control" placeholder="Escribe tu mensaje..." autocomplete="off">
            <button id="chat-message-submit" class="btn btn-primary">
                <i class="bi bi-send"></i>
            </button>
        </div>
    </div>
</div>
<script>
    // Force cache refresh - version 1.1
    function setPanelMode(mode) {
        const panel = document.getElementById('chat-panel');
        panel.classList.remove('fullscreen', 'docked');
        panel.classList.add(mode);
    }
    function isMobile() {
        return window.innerWidth <= 600;
    }
    document.addEventListener('DOMContentLoaded', async function() {
    const currentUserId = "";
        const panel = document.getElementById('chat-panel');
        const toggleDockBtn = document.getElementById('toggle-dock-btn');
        const toggleChatPanelBtn = document.getElementById('toggle-chat-panel');
        const restoreBtn = document.getElementById('chat-restore-btn');
        const goChatMainBtn = document.getElementById('go-chat-main-btn');
    const chatLog = document.getElementById('chat-log');
    const chatInput = document.getElementById('chat-message-input');
    const chatSubmit = document.getElementById('chat-message-submit');
    const roomSelector = document.getElementById('chat-room-selector');

        // Detecta si está en la página principal de chat
        function isChatMainPage() {
            return window.location.pathname.startsWith('/chat/room');
        }

        // Estado inicial del panel flotante
        let chatPanelState = localStorage.getItem('chatPanelState') || 'minimized';
        function applyPanelState(state) {
            if (isChatMainPage()) {
                setPanelMode('fullscreen');
                panel.classList.remove('hidden');
                restoreBtn.style.display = 'none';
            } else {
                setPanelMode('docked');
                if (state === 'minimized') {
                    panel.classList.add('hidden');
                    restoreBtn.style.display = 'flex';
                    restoreBtn.style.opacity = '1';
                } else {
                    panel.classList.remove('hidden');
                    restoreBtn.style.display = 'none';
                    restoreBtn.style.opacity = '0';
                }
            }
        }
        applyPanelState(chatPanelState);
        // Siempre mostrar funcionalidades completas en modo docked
        if (isMobile() && !isChatMainPage()) {
            setPanelMode('docked');
            // En móvil, mostrar siempre el contenido completo en docked
            const panelBody = document.querySelector('.chat-panel-body');
            const infoContainers = document.querySelector('.chat-info-containers');
            if (panelBody) panelBody.style.display = 'flex';
            if (infoContainers) infoContainers.style.display = 'flex';
        }
        toggleDockBtn.addEventListener('click', function() {
            if (panel.classList.contains('docked')) {
                setPanelMode('fullscreen');
                localStorage.setItem('chatPanelState', 'maximized');
            } else {
                setPanelMode('docked');
                localStorage.setItem('chatPanelState', 'docked');
            }
        });
        toggleChatPanelBtn.addEventListener('click', function() {
            panel.classList.add('hidden');
            restoreBtn.style.display = 'flex';
            restoreBtn.style.opacity = '1';
            localStorage.setItem('chatPanelState', 'minimized');
        });
        restoreBtn.addEventListener('click', function() {
            panel.classList.remove('hidden');
            restoreBtn.style.display = 'none';
            restoreBtn.style.opacity = '0';
            // Si está en la página principal de chat, restaurar pantalla completa
            if (isChatMainPage()) {
                setPanelMode('fullscreen');
                localStorage.setItem('chatPanelState', 'maximized');
            } else {
                setPanelMode('docked');
                localStorage.setItem('chatPanelState', 'docked');
            }

            // Reset unread count when panel is restored
            if (typeof lastRoomId !== 'undefined' && lastRoomId) {
                setTimeout(() => resetUnreadCount(lastRoomId), 500);
            }
        });
        window.addEventListener('resize', function() {
            if (isMobile() && !isChatMainPage()) {
                setPanelMode('docked');
                document.querySelector('.chat-panel-body').style.display = 'flex';
                document.querySelector('.chat-info-containers').style.display = 'flex';
            }
        });
        goChatMainBtn.addEventListener('click', function() {
            const currentRoom = roomSelector.value;
            if (currentRoom) {
                window.location.href = `/chat/room/${currentRoom}/`;
            } else {
                window.location.href = '/chat/room';
            }
        });

        // --- Obtener sala por defecto según historial de último acceso ---
        async function getLastRoom() {
            try {
                const response = await fetch('/chat/api/chat/last-room/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'same-origin'
                });
                if (response.ok) {
                    const data = await response.json();
                    return data.room_name || 'global';
                }
            } catch (e) {
                console.error('Error fetching last room:', e);
            }
            return 'global';
        }

        let chatSocket = null;
        let reconnectTimeout = null;
        let intentionalClose = false;
        let typingTimeout = null;
        let isTyping = false;
        let isPageVisible = true;
        let unreadMessageCount = 0;
        let isWidgetActive = false;
        let widgetVisibilityObserver = null;
        let readReceiptTimeout = null;
        let lastRoomId = null; // Declare at the beginning to avoid initialization error

        async function loadRoomsAndSelectLast() {
            let lastRoom = await getLastRoom();
            try {
                const response = await fetch('/chat/api/chat/room-list/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'same-origin'
                });
                if (response.ok) {
                    const data = await response.json();
                    roomSelector.innerHTML = '<option value="" disabled>Selecciona una sala...</option>';
                    data.rooms.forEach(room => {
                        const option = document.createElement('option');
                        option.value = room.id;
                        option.textContent = room.name;
                        roomSelector.appendChild(option);
                    });
                    // Check localStorage first for panel-specific last room
                    let selectedRoom = localStorage.getItem('chatPanelLastRoom') || lastRoom;

                    // Selecciona la sala por defecto si existe
                    if (selectedRoom && data.rooms.some(room => room.id == selectedRoom)) {
                        roomSelector.value = selectedRoom;
                        lastRoomId = selectedRoom;
                        console.log('Panel: Selected stored/last room:', selectedRoom);
                    } else if (lastRoom && data.rooms.some(room => room.id == lastRoom)) {
                        roomSelector.value = lastRoom;
                        lastRoomId = lastRoom;
                        localStorage.setItem('chatPanelLastRoom', lastRoom);
                        console.log('Panel: Selected API last room:', lastRoom);
                    } else if (data.rooms.length > 0) {
                        // Fallback to first available room
                        const firstRoom = data.rooms[0].id;
                        roomSelector.value = firstRoom;
                        lastRoomId = firstRoom;
                        localStorage.setItem('chatPanelLastRoom', firstRoom);
                        console.log('Panel: Selected first available room:', firstRoom);
                    }
                } else {
                    console.error('Panel: Failed to load rooms:', response.status);
                }
            } catch (e) {
                console.error('Panel: Error loading rooms:', e);
            }
        }

        // Ensure lastRoomId is initialized before calling loadRoomsAndSelectLast
        if (typeof lastRoomId === 'undefined') {
            lastRoomId = null;
        }
        await loadRoomsAndSelectLast();

        async function loadHistory(roomId) {
            chatLog.innerHTML = '';
            try {
                const response = await fetch(`/chat/api/chat/room-history/${roomId}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'same-origin'
                });
                if (response.ok) {
                    const data = await response.json();
                    if (Array.isArray(data.history)) {
                        data.history.forEach(msg => {
                            const isCurrentUser = msg.user_id == currentUserId;
                            const msgHtml = `<div class="d-flex mb-2 justify-content-${isCurrentUser ? 'end' : 'start'}">
                                <div class="message-bubble px-3 py-2 ${isCurrentUser ? 'outgoing text-white text-end' : 'incoming text-dark text-start'}" style="max-width: 75%; border-radius: 1.2em; background:${isCurrentUser ? '#007bff' : '#f8f9fa'};">
                                    <div class="small fw-bold mb-1">${msg.display_name || 'Usuario'}</div>
                                    <div class="message-content">${msg.content}</div>
                                    <div class="message-time small mt-1 text-muted">${msg.timestamp ? msg.timestamp.substring(11,19) : ''}</div>
                                </div>
                            </div>`;
                            chatLog.insertAdjacentHTML('beforeend', msgHtml);
                        });
                        chatLog.scrollTop = chatLog.scrollHeight;
                    }
                } else {
                    console.error('Panel: Failed to load history:', response.status);
                }
            } catch (e) {
                console.error('Panel: Error loading history:', e);
            }
        }

        function showTypingIndicator(userId, displayName) {
            const typingIndicator = document.getElementById('typing-indicator');
            if (!typingIndicator) return;
            typingIndicator.innerHTML = `<span></span><span></span><span></span> ${displayName} is typing...`;
            typingIndicator.style.display = 'block';
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.style.display = 'none';
            }
        }

        function handleHistoryCleared() {
            // Clear all messages from the chat log but keep the typing indicator
            const chatLog = document.getElementById('chat-log');
            const typingIndicator = document.getElementById('typing-indicator');
            chatLog.innerHTML = '';
            if (typingIndicator) {
                chatLog.appendChild(typingIndicator);
            }
            // Show a system message indicating history was cleared
            const systemMessage = document.createElement('div');
            systemMessage.className = 'text-center p-2';
            systemMessage.innerHTML = '<small class="text-muted">Chat history has been cleared</small>';
            chatLog.appendChild(systemMessage);
        }

        function resetUnreadCount(roomId) {
            if (!roomId || typeof roomId === 'undefined') return;

            fetch('/chat/api/chat/reset-unread/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                },
                body: JSON.stringify({
                    'room_id': roomId
                }),
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log(`Panel: Marked ${data.marked_read} messages as read for room ${roomId}`);
                    // Update the notification count in the header
                    if (window.updateNotificationCount) {
                        window.updateNotificationCount();
                    }
                    // Also trigger notification system refresh
                    if (window.NotificationManager && window.NotificationManager.forceRefresh) {
                        window.NotificationManager.forceRefresh();
                    }
                    // Dispatch custom event for other components
                    document.dispatchEvent(new CustomEvent('messagesMarkedAsRead', {
                        detail: { roomId: roomId, count: data.marked_read }
                    }));
                    // Update notification count immediately
                    if (window.updateNotificationFromWidget) {
                        window.updateNotificationFromWidget();
                    }
                    // Reset local unread counter
                    unreadMessageCount = 0;
                }
            })
            .catch(error => console.error('Panel: Error resetting unread count:', error));
        }

        function setupWidgetVisibilityObserver() {
            const panel = document.getElementById('chat-panel');
            if (!panel) return;

            // Disconnect existing observer
            if (widgetVisibilityObserver) {
                widgetVisibilityObserver.disconnect();
            }

            // Create new observer
            widgetVisibilityObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const wasActive = isWidgetActive;
                    isWidgetActive = entry.isIntersecting && isPageVisible && !panel.classList.contains('hidden');

                    console.log('Panel: Widget visibility changed:', {
                        isIntersecting: entry.isIntersecting,
                        isPageVisible,
                        isHidden: panel.classList.contains('hidden'),
                        isWidgetActive
                    });

                    // If widget became active and there are unread messages, mark them as read
                    if (isWidgetActive && !wasActive && unreadMessageCount > 0 && typeof lastRoomId !== 'undefined' && lastRoomId) {
                        console.log('Panel: Widget became visible, marking messages as read');
                        clearTimeout(readReceiptTimeout);
                        readReceiptTimeout = setTimeout(() => {
                            resetUnreadCount(lastRoomId);
                        }, 1000); // Wait 1 second to ensure user is actually reading
                    }
                });
            }, {
                threshold: 0.1, // Consider visible if at least 10% is visible
                rootMargin: '0px'
            });

            widgetVisibilityObserver.observe(panel);
        }

        function updateWidgetActiveState() {
            setupWidgetVisibilityObserver();
        }

        // Handle page visibility changes for smart read receipts
        document.addEventListener('visibilitychange', function() {
            isPageVisible = !document.hidden;
            console.log('Panel: Page visibility changed:', isPageVisible ? 'visible' : 'hidden');
            updateWidgetActiveState();
        });

        // Handle window focus/blur for better activity detection
        window.addEventListener('focus', function() {
            console.log('Panel: Window focused');
            isPageVisible = true;
            updateWidgetActiveState();

            // Mark messages as read when window gains focus and widget is visible
            if (isWidgetActive && unreadMessageCount > 0 && typeof lastRoomId !== 'undefined' && lastRoomId) {
                clearTimeout(readReceiptTimeout);
                readReceiptTimeout = setTimeout(() => {
                    resetUnreadCount(lastRoomId);
                }, 200); // Reduced to 200ms for faster response
            }
        });

        window.addEventListener('blur', function() {
            console.log('Panel: Window blurred');
            isPageVisible = false;
            updateWidgetActiveState();
        });

        // Handle widget state changes (minimize/maximize)
        toggleChatPanelBtn.addEventListener('click', function() {
            setTimeout(updateWidgetActiveState, 100);
        });

        toggleDockBtn.addEventListener('click', function() {
            setTimeout(updateWidgetActiveState, 100);
        });

        restoreBtn.addEventListener('click', function() {
            setTimeout(updateWidgetActiveState, 100);
        });

        // Enhanced mobile touch interactions
        function initializeMobileInteractions() {
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                // Add swipe gesture for chat panel
                let startY = 0;
                let startX = 0;
                let isSwiping = false;

                const chatPanel = document.getElementById('chat-panel');
                const swipeIndicator = document.createElement('div');
                swipeIndicator.className = 'swipe-indicator';
                swipeIndicator.textContent = 'Swipe to close';
                document.body.appendChild(swipeIndicator);

                // Touch start
                chatPanel.addEventListener('touchstart', function(e) {
                    if (chatPanel.classList.contains('fullscreen')) {
                        startY = e.touches[0].clientY;
                        startX = e.touches[0].clientX;
                        isSwiping = true;
                    }
                }, { passive: true });

                // Touch move
                chatPanel.addEventListener('touchmove', function(e) {
                    if (!isSwiping || !chatPanel.classList.contains('fullscreen')) return;

                    const currentY = e.touches[0].clientY;
                    const currentX = e.touches[0].clientX;
                    const deltaY = currentY - startY;
                    const deltaX = Math.abs(currentX - startX);

                    // Only handle vertical swipes
                    if (deltaX < 50 && deltaY > 50) {
                        swipeIndicator.classList.add('show');
                        e.preventDefault(); // Prevent scrolling
                    } else {
                        swipeIndicator.classList.remove('show');
                    }
                }, { passive: false });

                // Touch end
                chatPanel.addEventListener('touchend', function(e) {
                    if (!isSwiping) return;

                    const endY = e.changedTouches[0].clientY;
                    const deltaY = endY - startY;

                    swipeIndicator.classList.remove('show');

                    // If swiped down more than 100px, close fullscreen
                    if (deltaY > 100 && chatPanel.classList.contains('fullscreen')) {
                        setPanelMode('docked');
                        // Add haptic feedback
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                    }

                    isSwiping = false;
                });

                // Add haptic feedback to buttons
                const buttons = document.querySelectorAll('button');
                buttons.forEach(button => {
                    button.addEventListener('touchstart', function() {
                        this.classList.add('haptic-feedback');
                        if (navigator.vibrate) {
                            navigator.vibrate(10);
                        }
                    });

                    button.addEventListener('touchend', function() {
                        this.classList.remove('haptic-feedback');
                    });
                });

                // Improve scrolling performance on mobile
                const chatLog = document.getElementById('chat-log');
                let scrollTimeout;

                chatLog.addEventListener('scroll', function() {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(function() {
                        // Hide virtual keyboard when scrolling
                        document.activeElement.blur();
                    }, 150);
                }, { passive: true });

                // Handle orientation changes
                window.addEventListener('orientationchange', function() {
                    setTimeout(function() {
                        chatLog.scrollTop = chatLog.scrollHeight;
                        // Recalculate panel position
                        if (chatPanel.classList.contains('docked')) {
                            chatPanel.style.bottom = '20px';
                        }
                    }, 500);
                });

                // Prevent zoom on double tap
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(event) {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);

                // Add pull-to-refresh for chat messages
                let pullStartY = 0;
                let isPulling = false;

                chatLog.addEventListener('touchstart', function(e) {
                    if (chatLog.scrollTop === 0) {
                        pullStartY = e.touches[0].clientY;
                        isPulling = true;
                    }
                }, { passive: true });

                chatLog.addEventListener('touchmove', function(e) {
                    if (!isPulling) return;

                    const pullDistance = e.touches[0].clientY - pullStartY;
                    if (pullDistance > 50) {
                        // Show refresh indicator
                        chatLog.style.transform = `translateY(${Math.min(pullDistance - 50, 60)}px)`;
                        e.preventDefault();
                    }
                }, { passive: false });

                chatLog.addEventListener('touchend', function(e) {
                    if (!isPulling) return;

                    const pullDistance = e.changedTouches[0].clientY - pullStartY;
                    chatLog.style.transform = '';

                    if (pullDistance > 100) {
                        // Trigger refresh
                        console.log('Pull to refresh triggered');
                        // Could reload messages or show new messages
                    }

                    isPulling = false;
                });
            }
        }

        // Initialize widget active state
        updateWidgetActiveState();
        initializeMobileInteractions();

        // Cleanup function for when widget disconnects
        function cleanupWidgetResources() {
            if (widgetVisibilityObserver) {
                widgetVisibilityObserver.disconnect();
                widgetVisibilityObserver = null;
            }
            if (readReceiptTimeout) {
                clearTimeout(readReceiptTimeout);
                readReceiptTimeout = null;
            }
        }

        // Global function to update notification count from widget
        window.updateNotificationFromWidget = function() {
            console.log('Widget: Updating notification count from widget');
            if (window.NotificationManager && window.NotificationManager.forceRefresh) {
                window.NotificationManager.forceRefresh();
            }
        };

        // Cleanup on page unload
        window.addEventListener('beforeunload', cleanupWidgetResources);

        async function connectSocketWithHistory(roomId) {
            if (typeof lastRoomId !== 'undefined' && roomId === lastRoomId) return; // No recargar si no cambió la sala

            // Validate room ID
            if (!roomId || roomId.trim() === '') {
                console.error('Cannot connect: Invalid room ID');
                return;
            }

            lastRoomId = roomId;
            await loadHistory(roomId);
            // Reset unread count when loading history
            setTimeout(() => resetUnreadCount(roomId), 500);

            if (chatSocket) {
                intentionalClose = true;
                chatSocket.close();
                intentionalClose = false;
            }
            if (reconnectTimeout) {
                clearTimeout(reconnectTimeout);
                reconnectTimeout = null;
            }
            const wsScheme = window.location.protocol === 'https:' ? 'wss' : 'ws';
            const wsPath = `${wsScheme}://${window.location.host}/ws/chat/${roomId}/`;
            console.log('Panel connecting to WebSocket:', wsPath);
            chatSocket = new WebSocket(wsPath);
            chatSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                if (data.type === 'typing_start') {
                    if (data.user_id != currentUserId) {
                        showTypingIndicator(data.user_id, data.display_name);
                    }
                    return;
                }
                if (data.type === 'typing_stop') {
                    hideTypingIndicator();
                    return;
                }
                if (data.type === 'history_cleared') {
                    // Clear the chat history for all users in the room
                    handleHistoryCleared();
                    return;
                }
                if (data.message) {
                    const isCurrentUser = data.user_id == currentUserId;

                    // Track unread messages only if widget is not active
                    if (!isCurrentUser && !isWidgetActive) {
                        unreadMessageCount++;
                        console.log('Panel: Unread message count:', unreadMessageCount);
                    } else if (!isCurrentUser && isWidgetActive) {
                        // Widget is active, mark this message as read after a short delay
                        console.log('Panel: Widget active, will mark message as read');
                        clearTimeout(readReceiptTimeout);
                        readReceiptTimeout = setTimeout(() => {
                            if (typeof lastRoomId !== 'undefined' && lastRoomId && isWidgetActive) {
                                resetUnreadCount(lastRoomId);
                            }
                        }, 500); // Reduced to 0.5 seconds for faster confirmation
                    }

                    const msgHtml = `<div class="d-flex mb-2 justify-content-${isCurrentUser ? 'end' : 'start'}">
                        <div class="message-bubble px-3 py-2 ${isCurrentUser ? 'outgoing text-white text-end' : 'incoming text-dark text-start'}" style="max-width: 75%; border-radius: 1.2em; background:${isCurrentUser ? '#007bff' : '#f8f9fa'};">
                            <div class="small fw-bold mb-1">${data.display_name || 'Usuario'}</div>
                            <div class="message-content">${data.message}</div>
                            <div class="message-time small mt-1 text-muted">${data.timestamp ? data.timestamp.substring(11,19) : ''}</div>
                        </div>
                    </div>`;
                    chatLog.insertAdjacentHTML('beforeend', msgHtml);
                    chatLog.scrollTop = chatLog.scrollHeight;
                }
            };
            chatSocket.onclose = function(e) {
                // Solo reconectar si la sala sigue siendo la misma
                if (!intentionalClose && typeof lastRoomId !== 'undefined' && roomId === lastRoomId) {
                    reconnectTimeout = setTimeout(() => connectSocketWithHistory(roomId), 2000);
                }
            };

            chatSocket.onopen = function() {
                console.log('Panel: WebSocket connected, setting up visibility observer');
                // Setup visibility observer when WebSocket connects
                setTimeout(updateWidgetActiveState, 100);
            };
        }
        // Conectar al inicio después de cargar las salas
        setTimeout(() => {
            if (roomSelector.value && roomSelector.value !== '') {
                console.log('Panel: Connecting to initial room:', roomSelector.value);
                connectSocketWithHistory(roomSelector.value);
            } else {
                console.log('Panel: No room selected, waiting for user selection');
            }
        }, 1000); // Give time for room loading to complete

        roomSelector.addEventListener('change', function() {
            const newRoomId = roomSelector.value;
            if (newRoomId) {
                // Save to localStorage for persistence
                localStorage.setItem('chatPanelLastRoom', newRoomId);
                console.log('Panel: Saved room to localStorage:', newRoomId);

                connectSocketWithHistory(newRoomId);
                // Reset unread count when switching rooms
                setTimeout(() => resetUnreadCount(newRoomId), 1000);
            }
        });
        chatSubmit.addEventListener('click', function() {
            const message = chatInput.value.trim();
            if (message && chatSocket && chatSocket.readyState === WebSocket.OPEN) {
                chatSocket.send(JSON.stringify({ 'message': message }));
                chatInput.value = '';
            }
        });
        chatInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                chatSubmit.click();
            }
        });

        chatInput.addEventListener('input', function(e) {
            if (chatSocket && chatSocket.readyState === WebSocket.OPEN) {
                if (!isTyping) {
                    isTyping = true;
                    chatSocket.send(JSON.stringify({
                        'type': 'typing_start'
                    }));
                }
                clearTimeout(typingTimeout);
                typingTimeout = setTimeout(function() {
                    isTyping = false;
                    chatSocket.send(JSON.stringify({
                        'type': 'typing_stop'
                    }));
                }, 1000);
            }
        });
    });
</script>

            

            
            
                
<!-- ============================================================================
     INBOX GTD FLOATING BUTTON - GLOBAL ACCESS COMPONENT
     ============================================================================
     This template contains the HTML structure for the global inbox GTD
     floating button that provides quick access to inbox functionality from any page.

     Features:
     - Floating button with pulse animation
     - Expandable panel with quick capture form
     - Real-time statistics display
     - Toast notifications integration
     - Responsive design for all screen sizes
     - Accessibility features (keyboard navigation, ARIA labels)

     Dependencies:
     - Bootstrap 5.x
     - Bootstrap Icons
     - inbox_floating_button.css
     - inbox_floating_button.js

     ============================================================================ -->

<!-- Inbox GTD Floating Container -->
<div id="inboxFloatingContainer" class="inbox-floating-container">
    <!-- Floating Button -->
    <div class="inbox-floating-button" id="inboxFloatingButton" role="button" tabindex="0" aria-label="Abrir Inbox GTD (Ctrl+I)">
        <div class="inbox-button-content">
            <i class="bi bi-lightning-charge-fill inbox-icon-main" aria-hidden="true"></i>
            <span class="inbox-badge" id="inboxBadge" aria-label="Items pendientes en inbox">0</span>
        </div>
        <div class="inbox-pulse-ring" aria-hidden="true"></div>
    </div>

    <!-- Expandable Panel -->
    <div class="inbox-panel" id="inboxPanel" role="dialog" aria-labelledby="inboxPanelTitle" aria-hidden="true">
        <!-- Panel Header -->
        <div class="inbox-panel-header">
            <h3 class="inbox-panel-title" id="inboxPanelTitle">
                <i class="bi bi-inbox-fill" aria-hidden="true"></i>
                Inbox GTD
            </h3>
            <button class="inbox-panel-close" id="inboxPanelClose" aria-label="Cerrar panel de inbox">
                <i class="bi bi-x-lg" aria-hidden="true"></i>
            </button>
        </div>

        <!-- Quick Capture Form -->
        <form class="inbox-quick-form" id="inboxQuickForm">
            <div class="inbox-form-group">
                <label for="inboxQuickTitle">Título *</label>
                <input
                    type="text"
                    id="inboxQuickTitle"
                    name="title"
                    placeholder="¿Qué necesitas capturar?"
                    required
                    aria-describedby="titleHelp"
                    autocomplete="off"
                >
                <small id="titleHelp" class="form-text text-muted">Describe brevemente lo que quieres recordar o hacer</small>
            </div>

            <div class="inbox-form-group">
                <label for="inboxQuickDescription">Descripción (opcional)</label>
                <textarea
                    id="inboxQuickDescription"
                    name="description"
                    placeholder="Agrega más detalles si es necesario..."
                    rows="3"
                    aria-describedby="descHelp"
                ></textarea>
                <small id="descHelp" class="form-text text-muted">Información adicional para contextualizar el item</small>
            </div>

            <div class="inbox-form-actions">
                <button type="submit" class="inbox-btn-primary" id="inboxQuickSubmit">
                    <i class="bi bi-lightning-charge-fill" aria-hidden="true"></i>
                    Capturar
                </button>
                <button type="button" class="inbox-btn-secondary" onclick="window.open('/events/inbox/', '_blank')">
                    <i class="bi bi-box-arrow-up-right" aria-hidden="true"></i>
                    Ver Inbox
                </button>
            </div>
        </form>

        <!-- Statistics Section -->
        <div class="inbox-stats">
            <div class="inbox-stats-grid">
                <div class="inbox-stat-item">
                    <div class="inbox-stat-number" id="inboxStatTotal">0</div>
                    <div class="inbox-stat-label">Total</div>
                </div>
                <div class="inbox-stat-item">
                    <div class="inbox-stat-number" id="inboxStatUnprocessed">0</div>
                    <div class="inbox-stat-label">Pendientes</div>
                </div>
                <div class="inbox-stat-item">
                    <div class="inbox-stat-number" id="inboxStatProcessed">0</div>
                    <div class="inbox-stat-label">Procesados</div>
                </div>
                <div class="inbox-stat-item">
                    <div class="inbox-stat-number" id="inboxStatToday">0</div>
                    <div class="inbox-stat-label">Hoy</div>
                </div>
                <div class="inbox-stat-item">
                    <div class="inbox-stat-number" id="inboxStatRecent">0</div>
                    <div class="inbox-stat-label">Recientes</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Access Tooltip (shown on hover) -->
<div class="inbox-tooltip" id="inboxTooltip" role="tooltip" aria-hidden="true">
    <div class="inbox-tooltip-content">
        <strong>Inbox GTD</strong>
        <small>Captura rápida de ideas y tareas</small>
        <div class="inbox-tooltip-shortcut">
            <kbd>Ctrl</kbd> + <kbd>I</kbd>
        </div>
    </div>
</div>

<!-- ============================================================================
     ACCESSIBILITY ENHANCEMENTS
     ============================================================================ -->

<!-- Screen Reader Announcements -->
<div id="inboxAnnouncements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<!-- ============================================================================
     STYLE OVERRIDES (for specific customizations)
     ============================================================================ -->
<style>
/* Custom styles that complement the main CSS file */

/* Enhanced focus styles for better accessibility */
.inbox-floating-button:focus-visible {
    outline: 3px solid #007bff;
    outline-offset: 3px;
}

/* Loading animation for the submit button */
.inbox-btn-primary:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

/* Enhanced badge animation */
.inbox-badge {
    animation: badgePulse 2s infinite;
}

@keyframes badgePulse {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
    }
    50% {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.5);
    }
}

/* Tooltip styles */
.inbox-tooltip {
    position: absolute;
    bottom: 80px;
    right: 70px;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    z-index: 1052;
    white-space: nowrap;
}

.inbox-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    right: 20px;
    border: 5px solid transparent;
    border-top-color: rgba(0, 0, 0, 0.9);
}

.inbox-floating-button:hover + .inbox-tooltip,
.inbox-tooltip:hover {
    opacity: 1;
    visibility: visible;
}

.inbox-tooltip-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.inbox-tooltip-shortcut {
    margin-top: 4px;
    display: flex;
    gap: 2px;
    align-items: center;
}

.inbox-tooltip-shortcut kbd {
    background: rgba(255, 255, 255, 0.2);
    padding: 1px 4px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 500;
}

/* Screen reader only styles */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.sr-only-focusable:focus {
    position: static;
    width: auto;
    height: auto;
    padding: 8px 16px;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .inbox-tooltip {
        display: none;
    }

    .inbox-stats-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 480px) {
    .inbox-stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .inbox-form-actions {
        flex-direction: column;
    }

    .inbox-btn-secondary {
        margin-top: 8px;
    }
}
</style>

<!-- ============================================================================
     INITIALIZATION SCRIPT
     ============================================================================ -->
<script>
// Initialize tooltips and other Bootstrap components when document is ready
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap tooltips if available
    if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    }

    // Add keyboard shortcut hint on first visit
    const hasSeenShortcut = localStorage.getItem('inboxGTD_shortcut_shown');
    if (!hasSeenShortcut) {
        setTimeout(() => {
            const tooltip = document.getElementById('inboxTooltip');
            if (tooltip) {
                tooltip.style.opacity = '1';
                tooltip.style.visibility = 'visible';
                setTimeout(() => {
                    tooltip.style.opacity = '0';
                    tooltip.style.visibility = 'hidden';
                }, 3000);
            }
            localStorage.setItem('inboxGTD_shortcut_shown', 'true');
        }, 3000);
    }
});
</script>
            
        </div>
        
    </main>

    
    <footer id="footer" class="footer">
        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="col-12 col-md-8">
                    <div class="project-credits mb-2">
                        <div class="copyright">
                            &copy; Copyright <strong><span>Management360</span></strong>. Todos los derechos reservados
                        </div>
                    </div>
                    <div class="third-party-credits">
                        <div class="credits">
                            <p>Plantilla base: <strong>NiceAdmin</strong></p>
                            <p>&copy; Copyright <strong>NiceAdmin</strong>. All Rights Reserved</p>
                            <p>Diseñado por <a href="https://bootstrapmade.com/" rel="noopener noreferrer" target="_blank">BootstrapMade</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center" aria-label="Back to top">
        <i class="bi bi-arrow-up-short"></i>
    </a>

    
    <script src="/static/assets/vendor/bootstrap/js/bootstrap.bundle.min.js" defer></script>
    <script src="/static/assets/vendor/apexcharts/apexcharts.min.js" defer></script>
    <script src="/static/assets/vendor/chart.js/chart.umd.js" defer></script>
    <script src="/static/assets/vendor/echarts/echarts.min.js" defer></script>
    <script src="/static/assets/vendor/quill/quill.js" defer></script>
    <script src="/static/assets/vendor/simple-datatables/simple-datatables.js" defer></script>
    <script src="/static/assets/vendor/tinymce/tinymce.min.js" defer></script>
    <script src="/static/assets/vendor/php-email-form/validate.js" defer></script>

    
    <script src="/static/assets/js/main.js" defer></script>

    
    
    <script src="/static/assets/js/notifications.js" defer></script>
    

    
    
    <script src="/static/assets/js/inbox_floating_button.js" defer></script>
    

    
    
<!-- JavaScript para el Gestor de Contenido -->
<script src="/static/js/content_manager.js"></script>




    
    <script nonce="">
        document.addEventListener('DOMContentLoaded', function() {
            // Configuración de alertas
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                const closeButton = alert.querySelector('.btn-close');
                if (closeButton) {
                    closeButton.addEventListener('click', () => {
                        alert.style.transition = 'opacity 0.5s ease';
                        alert.style.opacity = '0';
                        setTimeout(() => alert.remove(), 500);
                    });
                }
                
                setTimeout(() => {
                    alert.style.transition = 'opacity 0.5s ease';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                }, 5000);
            });

            // Configuración del botón "Volver arriba"
            const backToTopButton = document.querySelector('.back-to-top');
            if (backToTopButton) {
                const toggleVisibility = () => {
                    backToTopButton.style.display = window.pageYOffset > 100 ? 'flex' : 'none';
                };

                window.addEventListener('scroll', toggleVisibility);
                toggleVisibility(); // Estado inicial
                
                backToTopButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            }
        });
    </script>
</body>
</html>