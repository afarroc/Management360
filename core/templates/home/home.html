{% extends 'layouts/base.html' %}
{% load static %}
{% load schedule_filters %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load widget_tweaks %}
{% load custom_tags %}
{% load cache %}

{% block content %}
  {# Message Notifications #}
  {% if messages %}
    {% include 'layouts/includes/alert.html' %}
  {% endif %}

  {# Page Header with Navigation #}
  <div class="pagetitle">
    <div class="container">
      <h1>{{ page_title }}</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
          <li class="breadcrumb-item active">{{ page_title }}</li>
        </ol>
      </nav>
    </div>
  </div>

  {# Main Navigation Tabs #}
  <div class="container-fluid mb-4">
    <div class="nav-tabs-wrapper">
      <ul class="nav nav-tabs nav-fill" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
            <i class="bi bi-speedometer2 me-2"></i>
            <span class="d-none d-sm-inline">Dashboard</span>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab">
            <i class="bi bi-calendar-event me-2"></i>
            <span class="d-none d-sm-inline">Events</span>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="projects-tab" data-bs-toggle="tab" data-bs-target="#projects" type="button" role="tab">
            <i class="bi bi-kanban me-2"></i>
            <span class="d-none d-sm-inline">Projects</span>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tools-tab" data-bs-toggle="tab" data-bs-target="#tools" type="button" role="tab">
            <i class="bi bi-tools me-2"></i>
            <span class="d-none d-sm-inline">Tools</span>
          </button>
        </li>
      </ul>
    </div>
  </div>

  {# Main Content Sections #}
  <div class="tab-content" id="mainTabsContent">
    
    {# Dashboard Tab #}
    <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
      <section class="section dashboard">
        <div class="row">
          {# Left Side Content #}
          <div class="col-lg-8">
            {# Cached Quick Stats Row #}
            {% cache 300 dashboard_stats user.username days days_ago %}
            <div class="row">
              <div class="col-xxl-4 col-md-6">
                <div class="card info-card sales-card">
                  <div class="card-body">
                    <h5 class="card-title">Tasks <span>| Today</span></h5>
                    <div class="d-flex align-items-center">
                      <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                        <i class="bi bi-list-check"></i>
                      </div>
                      <div class="ps-3">
                        <h6 class="counter" data-target="{{ pending_tasks }}">{{ pending_tasks }}</h6>
                        <span class="text-muted small pt-2 ps-1">Pending Tasks</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xxl-4 col-md-6">
                <div class="card info-card revenue-card">
                  <div class="card-body">
                    <h5 class="card-title">Events <span>| This Week</span></h5>
                    <div class="d-flex align-items-center">
                      <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                        <i class="bi bi-calendar-event"></i>
                      </div>
                      <div class="ps-3">
                        <h6 class="counter" data-target="{{ upcoming_events_count }}">{{ upcoming_events_count }}</h6>
                        <span class="text-muted small pt-2 ps-1">Upcoming Events</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xxl-4 col-md-6">
                <div class="card info-card customers-card">
                  <div class="card-body">
                    <h5 class="card-title">Projects <span>| Active</span></h5>
                    <div class="d-flex align-items-center">
                      <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                        <i class="bi bi-kanban"></i>
                      </div>
                      <div class="ps-3">
                        <h6 class="counter" data-target="{{ active_projects }}">{{ active_projects }}</h6>
                        <span class="text-muted small pt-2 ps-1">Active Projects</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endcache %}

            {# Quick Actions #}
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Quick Actions</h5>
                <div class="row g-2">
                  <div class="col-md-6">
                    <a href="{% url 'event_create' %}" class="btn btn-primary w-100 d-flex align-items-center justify-content-center">
                      <i class="bi bi-calendar-plus me-2"></i>
                      <span>Create Event</span>
                    </a>
                  </div>
                  <div class="col-md-6">
                    <a href="{% url 'task_create' %}" class="btn btn-success w-100 d-flex align-items-center justify-content-center">
                      <i class="bi bi-plus-circle me-2"></i>
                      <span>Add Task</span>
                    </a>
                  </div>
                  <div class="col-md-6">
                    <a href="{% url 'project_create' %}" class="btn btn-info w-100 d-flex align-items-center justify-content-center">
                      <i class="bi bi-folder-plus me-2"></i>
                      <span>New Project</span>
                    </a>
                  </div>
                  <div class="col-md-6">
                    <a href="{% url 'events' %}" class="btn btn-secondary w-100 d-flex align-items-center justify-content-center">
                      <i class="bi bi-grid me-2"></i>
                      <span>View All</span>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            {# Recent Activities Timeline #}
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="card-title">Recent Activities</h5>
                  <a href="{% url 'events' %}" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="activity">
                  {% for activity in recent_activities|slice:":5" %}
                    <div class="activity-item d-flex">
                      <div class="activite-label">{{ activity.timestamp|timesince }} ago</div>
                      <i class="bi bi-circle-fill activity-badge text-{{ activity.get_badge_color }} align-self-start"></i>
                      <div class="activity-content">
                        {{ activity.message }}
                        <div class="text-muted small">{{ activity.timestamp|date:"M d, h:i A" }}</div>
                      </div>
                    </div>
                  {% empty %}
                    <div class="text-center py-4">
                      <i class="bi bi-activity text-muted" style="font-size: 2rem;"></i>
                      <p class="text-muted mt-2">No recent activities</p>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>

          {# Right Sidebar #}
          <div class="col-lg-4">
            {# User Profile Card #}
            <div class="card">
              <div class="card-body profile-card text-center">
                <div class="profile-avatar-container mb-3">
                  <img src="{% static 'images/default-avatar.png' %}"
                       alt="Profile"
                       class="rounded-circle lazy"
                       width="80"
                       height="80"
                       loading="lazy"
                       data-src="{% static 'images/default-avatar.png' %}">
                </div>
                <h5 class="card-title">{{ user.get_full_name|default:user.username }}</h5>
                <p class="text-muted">Management360 User</p>

                {# Profile Completion #}
                <div class="mt-3">
                  <div class="d-flex justify-content-between small mb-1">
                    <span>Profile Completion</span>
                    <span>{{ profile_completion }}%</span>
                  </div>
                  <div class="progress" style="height: 6px;">
                    <div class="progress-bar bg-success" role="progressbar"
                         style="width: {{ profile_completion }}%"
                         aria-valuenow="{{ profile_completion }}"
                         aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>

                {# Quick Links #}
                <div class="mt-3">
                  <a href="{% url 'events' %}" class="btn btn-outline-primary btn-sm w-100 mb-2">
                    <i class="bi bi-calendar-event me-1"></i> My Events
                  </a>
                  <a href="{% url 'projects' %}" class="btn btn-outline-success btn-sm w-100 mb-2">
                    <i class="bi bi-kanban me-1"></i> My Projects
                  </a>
                  <a href="{% url 'tasks' %}" class="btn btn-outline-info btn-sm w-100">
                    <i class="bi bi-list-check me-1"></i> My Tasks
                  </a>
                </div>
              </div>
            </div>

            {# Upcoming Events #}
            <div class="card">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="card-title">Upcoming Events</h5>
                  <a href="{% url 'event_create' %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-plus"></i>
                  </a>
                </div>

                {% if upcoming_events %}
                  <div class="list-group list-group-flush">
                    {% for event in upcoming_events|slice:":3" %}
                      <a href="{% url 'event_detail' event.id %}" class="list-group-item list-group-item-action px-0">
                        <div class="d-flex align-items-center">
                          <div class="flex-shrink-0 me-3">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                              <i class="bi bi-calendar-event text-white" style="font-size: 14px;"></i>
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-0 small">{{ event.title|truncatechars:25 }}</h6>
                            <small class="text-muted">{{ event.start_time|date:"M d, h:i A" }}</small>
                          </div>
                        </div>
                      </a>
                    {% endfor %}
                  </div>
                  <div class="mt-3">
                    <a href="{% url 'events' %}" class="btn btn-sm btn-outline-primary w-100">
                      View All Events
                    </a>
                  </div>
                {% else %}
                  <div class="text-center py-4">
                    <i class="bi bi-calendar text-muted" style="font-size: 2rem;"></i>
                    <p class="text-muted mt-2 small">No upcoming events</p>
                    <a href="{% url 'event_create' %}" class="btn btn-sm btn-primary">Create Event</a>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    {# Events Tab #}
    <div class="tab-pane fade" id="events" role="tabpanel">
      <section class="section">
        <div class="row">
          <div class="col-lg-8">
            {# Events Calendar View #}
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="card-title">Events Calendar</h5>
                  <div>
                    <a href="{% url 'event_create' %}" class="btn btn-sm btn-primary">
                      <i class="bi bi-plus"></i> New Event
                    </a>
                    <a href="{% url 'event_panel' %}" class="btn btn-sm btn-outline-secondary">
                      <i class="bi bi-grid"></i> Panel View
                    </a>
                  </div>
                </div>
                <div id="calendar"></div>
              </div>
            </div>

            {# Recent Events #}
            <div class="card shadow-sm mt-4">
              <div class="card-body">
                <h5 class="card-title">Recent Events</h5>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for event in recent_events|slice:":5" %}
                        <tr>
                          <td>{{ event.title }}</td>
                          <td>{{ event.start_time|date:"M d, Y" }}</td>
                          <td><span class="badge bg-{{ event.get_status_class }}">{{ event.get_status_display }}</span></td>
                          <td>
                            <a href="{% url 'event_detail' event.id %}" class="btn btn-sm btn-outline-primary">
                              <i class="bi bi-eye"></i>
                            </a>
                            <a href="{% url 'event_edit' event.id %}" class="btn btn-sm btn-outline-secondary">
                              <i class="bi bi-pencil"></i>
                            </a>
                          </td>
                        </tr>
                      {% empty %}
                        <tr>
                          <td colspan="4" class="text-center py-4 text-muted">No recent events</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                <a href="{% url 'events' %}" class="btn btn-sm btn-outline-primary w-100 mt-2">
                  View All Events
                </a>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            {# Cached Event Categories #}
            {% cache 900 event_categories %}
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="card-title">Event Categories</h5>
                  <a href="#" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                    <i class="bi bi-plus"></i> Add
                  </a>
                </div>
                <div class="list-group">
                  {% for category in event_categories %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <span>
                        <span class="badge me-2" style="background-color: {{ category.color }}">&nbsp;</span>
                        {{ category.name }}
                      </span>
                      <div>
                        <a href="#" class="btn btn-sm p-0 text-primary"><i class="bi bi-pencil"></i></a>
                        <a href="#" class="btn btn-sm p-0 text-danger"><i class="bi bi-trash"></i></a>
                      </div>
                    </div>
                  {% empty %}
                    <div class="text-center py-4 text-muted">
                      <i class="bi bi-tags" style="font-size: 2rem;"></i>
                      <p class="mt-2">No categories defined</p>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
            {% endcache %}

            {# Event Status Management #}
            <div class="card shadow-sm mt-4">
              <div class="card-body">
                <h5 class="card-title">Event Status</h5>
                <div class="list-group">
                  {% for status in event_statuses %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <span>
                        <span class="badge bg-{{ status.color_class }} me-2">{{ status.name }}</span>
                        {{ status.description }}
                      </span>
                      <div>
                        <a href="{% url 'status_edit' status.id %}" class="btn btn-sm p-0 text-primary">
                          <i class="bi bi-pencil"></i>
                        </a>
                      </div>
                    </div>
                  {% empty %}
                    <div class="text-center py-4 text-muted">
                      <i class="bi bi-list-check" style="font-size: 2rem;"></i>
                      <p class="mt-2">No statuses defined</p>
                    </div>
                  {% endfor %}
                </div>
                <a href="{% url 'status_create' %}" class="btn btn-sm btn-outline-primary w-100 mt-2">
                  <i class="bi bi-plus"></i> Add Status
                </a>
              </div>
            </div>
          </div>
        </div>

        {# Event Status Management #}
        <div class="card shadow-sm mt-4">
          <div class="card-body">
            <h5 class="card-title">Event Status</h5>
            <div class="list-group">
              {% for status in event_statuses %}
                <div class="list-group-item d-flex justify-content-between align-items-center">
                  <span>
                    <span class="badge bg-{{ status.color_class }} me-2">{{ status.name }}</span>
                    {{ status.description }}
                  </span>
                  <div>
                    <a href="{% url 'status_edit' status.id %}" class="btn btn-sm p-0 text-primary">
                      <i class="bi bi-pencil"></i>
                    </a>
                  </div>
                </div>
              {% empty %}
                <div class="text-center py-4 text-muted">
                  <i class="bi bi-list-check" style="font-size: 2rem;"></i>
                  <p class="mt-2">No statuses defined</p>
                </div>
              {% endfor %}
            </div>
            <a href="{% url 'status_create' %}" class="btn btn-sm btn-outline-primary w-100 mt-2">
              <i class="bi bi-plus"></i> Add Status
            </a>
          </div>
        </div>

        {# Quick Actions #}
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Quick Actions</h5>
            <div class="row g-2">
              <div class="col-md-6">
                <a href="{% url 'event_create' %}" class="btn btn-primary w-100 d-flex align-items-center justify-content-center">
                  <i class="bi bi-calendar-plus me-2"></i>
                  <span>Create Event</span>
                </a>
              </div>
              <div class="col-md-6">
                <a href="{% url 'task_create' %}" class="btn btn-success w-100 d-flex align-items-center justify-content-center">
                  <i class="bi bi-plus-circle me-2"></i>
                  <span>Add Task</span>
                </a>
              </div>
              <div class="col-md-6">
                <a href="{% url 'project_create' %}" class="btn btn-info w-100 d-flex align-items-center justify-content-center">
                  <i class="bi bi-folder-plus me-2"></i>
                  <span>New Project</span>
                </a>
              </div>
              <div class="col-md-6">
                <a href="{% url 'events' %}" class="btn btn-secondary w-100 d-flex align-items-center justify-content-center">
                  <i class="bi bi-grid me-2"></i>
                  <span>View All</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    {# Projects Tab #}
    <div class="tab-pane fade" id="projects" role="tabpanel">
      <section class="section">
        <div class="row">
          <div class="col-lg-8">
            {# Projects Overview #}
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="card-title">My Projects</h5>
                  <a href="{% url 'project_create' %}" class="btn btn-sm btn-primary">
                    <i class="bi bi-plus"></i> New Project
                  </a>
                </div>
                
                <div class="row">
                  {% for project in active_projects_list|slice:":3" %}
                    <div class="col-md-4">
                      <div class="card project-card mb-3">
                        <div class="card-body">
                          <div class="d-flex justify-content-between align-items-start">
                            <h6>{{ project.name }}</h6>
                            <span class="badge bg-{{ project.get_status_class }}">{{ project.get_status_display }}</span>
                          </div>
                          <p class="small text-muted mt-2">{{ project.description|truncatechars:60 }}</p>
                          <div class="progress mb-2" style="height: 5px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: {{ project.completion_percentage }}%" 
                                 aria-valuenow="{{ project.completion_percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                          </div>
                          <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">{{ project.completion_percentage }}% complete</small>
                            <small class="text-muted">{{ project.tasks.count }} tasks</small>
                          </div>
                          <div class="mt-3 d-flex gap-2">
                            <a href="{% url 'project_detail' project.id %}" class="btn btn-sm btn-outline-primary">
                              <i class="bi bi-eye"></i>
                            </a>
                            <a href="{% url 'project_edit' project.id %}" class="btn btn-sm btn-outline-secondary">
                              <i class="bi bi-pencil"></i>
                            </a>
                            <a href="{% url 'task_create' %}?project={{ project.id }}" class="btn btn-sm btn-outline-success">
                              <i class="bi bi-plus"></i> Task
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% empty %}
                    <div class="col-12 text-center py-4 text-muted">
                      <i class="bi bi-folder" style="font-size: 2rem;"></i>
                      <p class="mt-2">No active projects</p>
                      <a href="{% url 'project_create' %}" class="btn btn-sm btn-primary">Create Project</a>
                    </div>
                  {% endfor %}
                </div>
                
                <a href="{% url 'projects' %}" class="btn btn-sm btn-outline-primary w-100 mt-2">
                  View All Projects
                </a>
              </div>
            </div>

            {# Project Tasks #}
            <div class="card shadow-sm mt-4">
              <div class="card-body">
                <h5 class="card-title">Recent Tasks</h5>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Task</th>
                        <th>Project</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for task in recent_tasks|slice:":5" %}
                        <tr>
                          <td>{{ task.title }}</td>
                          <td>
                            {% if task.project %}
                              <a href="{% url 'project_detail' task.project.id %}">{{ task.project.name }}</a>
                            {% else %}
                              <span class="text-muted">None</span>
                            {% endif %}
                          </td>
                          <td>{{ task.due_date|date:"M d, Y"|default:"-" }}</td>
                          <td><span class="badge bg-{{ task.get_status_class }}">{{ task.get_status_display }}</span></td>
                          <td>
                            <a href="{% url 'task_edit' task.id %}" class="btn btn-sm btn-outline-primary">
                              <i class="bi bi-pencil"></i>
                            </a>
                          </td>
                        </tr>
                      {% empty %}
                        <tr>
                          <td colspan="5" class="text-center py-4 text-muted">No recent tasks</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                <a href="{% url 'tasks' %}" class="btn btn-sm btn-outline-primary w-100 mt-2">
                  View All Tasks
                </a>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            {# Project Status Management #}
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title">Project Status</h5>
                <div class="list-group">
                  {% for status in project_statuses %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <span>
                        <span class="badge bg-{{ status.color_class }} me-2">{{ status.name }}</span>
                        {{ status.description }}
                      </span>
                      <div>
                        <a href="{% url 'status_edit' status.id %}" class="btn btn-sm p-0 text-primary">
                          <i class="bi bi-pencil"></i>
                        </a>
                      </div>
                    </div>
                  {% empty %}
                    <div class="text-center py-4 text-muted">
                      <i class="bi bi-list-check" style="font-size: 2rem;"></i>
                      <p class="mt-2">No statuses defined</p>
                    </div>
                  {% endfor %}
                </div>
                <a href="{% url 'status_create' %}?model=project" class="btn btn-sm btn-outline-primary w-100 mt-2">
                  <i class="bi bi-plus"></i> Add Status
                </a>
              </div>
            </div>

            {# Project Categories #}
            <div class="card shadow-sm mt-4">
              <div class="card-body">
                <h5 class="card-title">Project Categories</h5>
                <div class="list-group">
                  {% for category in project_categories %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <span>{{ category.name }}</span>
                      <div>
                        <a href="{% url 'edit_classification' category.id %}" class="btn btn-sm p-0 text-primary">
                          <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{% url 'delete_classification' category.id %}" class="btn btn-sm p-0 text-danger">
                          <i class="bi bi-trash"></i>
                        </a>
                      </div>
                    </div>
                  {% empty %}
                    <div class="text-center py-4 text-muted">
                      <i class="bi bi-tags" style="font-size: 2rem;"></i>
                      <p class="mt-2">No categories defined</p>
                    </div>
                  {% endfor %}
                </div>
                <a href="{% url 'create_classification' %}" class="btn btn-sm btn-outline-primary w-100 mt-2">
                  <i class="bi bi-plus"></i> Add Category
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    {# Tools Tab #}
    <div class="tab-pane fade" id="tools" role="tabpanel">
      <section class="section">
        {% cache 1800 tools_section user.username %}
        <div class="row">
          {# CV Tools #}
          <div class="col-md-6">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="bi bi-file-earmark-person me-2"></i> CV Management
                </h5>
                <p class="card-text">Manage your professional curriculum vitae and documents.</p>
                <div class="d-flex flex-wrap gap-2 mt-3">
                  <a href="{% url 'cv:cv_detail' %}" class="btn btn-outline-primary">
                    <i class="bi bi-eye"></i> View CV
                  </a>
                  <a href="{% url 'cv:cv_edit' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-pencil"></i> Edit Basic
                  </a>
                  <a href="{% url 'cv:document_upload' %}" class="btn btn-outline-success">
                    <i class="bi bi-upload"></i> Upload Docs
                  </a>
                </div>
              </div>
            </div>
          </div>

          {# Password Generator #}
          <div class="col-md-6">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="bi bi-key me-2"></i> Password Generator
                </h5>
                <p class="card-text">Generate secure passwords for your accounts.</p>
                <div class="d-flex flex-wrap gap-2 mt-3">
                  <a href="{% url 'generate_password' %}" class="btn btn-outline-primary">
                    <i class="bi bi-key"></i> Generate
                  </a>
                  <a href="{% url 'password_help' %}" class="btn btn-outline-info">
                    <i class="bi bi-question-circle"></i> Help
                  </a>
                </div>
              </div>
            </div>
          </div>

          {# Memento Mori #}
          <div class="col-md-6 mt-4">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="bi bi-clock-history me-2"></i> Memento Mori
                </h5>
                <p class="card-text">Reflect on the passage of time and life's impermanence.</p>
                <div class="d-flex flex-wrap gap-2 mt-3">
                  <a href="{% url 'memento_default' %}" class="btn btn-outline-dark">
                    <i class="bi bi-eye"></i> View
                  </a>
                  <a href="{% url 'memento_create' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-gear"></i> Configure
                  </a>
                </div>
              </div>
            </div>
          </div>

          {# Chat Tools #}
          <div class="col-md-6 mt-4">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="bi bi-chat-left-text me-2"></i> Chat Tools
                </h5>
                <p class="card-text">Communicate with your team and AI assistant.</p>
                <div class="d-flex flex-wrap gap-2 mt-3">
                  <a href="{% url 'chat:room_list' %}" class="btn btn-outline-primary">
                    <i class="bi bi-chat"></i> General Chat
                  </a>
                  <a href="{% url 'chat:assistant_ui' %}" class="btn btn-outline-info">
                    <i class="bi bi-robot"></i> AI Assistant
                  </a>
                  <a href="{% url 'chat:clear_history' %}" class="btn btn-outline-danger">
                    <i class="bi bi-trash"></i> Clear Chat
                  </a>
                </div>
              </div>
            </div>
          </div>

          {# KPI Dashboard #}
          <div class="col-md-6 mt-4">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="bi bi-bar-chart-line me-2"></i> KPI Dashboard
                </h5>
                <p class="card-text">Track your key performance indicators and metrics.</p>
                <div class="d-flex flex-wrap gap-2 mt-3">
                  <a href="{% url 'dashboard' %}" class="btn btn-outline-primary">
                    <i class="bi bi-speedometer2"></i> View Dashboard
                  </a>
                  <a href="{% url 'export_data' %}" class="btn btn-outline-success">
                    <i class="bi bi-download"></i> Export Data
                  </a>
                </div>
              </div>
            </div>
          </div>

          {# Room Management #}
          <div class="col-md-6 mt-4">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="bi bi-door-open me-2"></i> Room Management
                </h5>
                <p class="card-text">Manage your virtual rooms and spaces.</p>
                <div class="d-flex flex-wrap gap-2 mt-3">
                  <a href="{% url 'chat:room' room_name='general' %}" class="btn btn-outline-primary">
                    <i class="bi bi-door-open"></i> Join Room
                  </a>
                  <a href="#" class="btn btn-outline-secondary">
                    <i class="bi bi-gear"></i> Manage
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endcache %}
      </section>
    </div>
  </div>

  {# Add Category Modal #}
  <div class="modal fade" id="addCategoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form method="post" action="{% url 'status_create' %}">
            {% csrf_token %}
            <div class="mb-3">
              <label for="categoryName" class="form-label">Category Name</label>
              <input type="text" class="form-control" id="categoryName" name="name" required>
            </div>
            <div class="mb-3">
              <label for="categoryColor" class="form-label">Color</label>
              <input type="color" class="form-control form-control-color" id="categoryColor" name="color" value="#0d6efd">
            </div>
            <div class="mb-3">
              <label for="categoryDescription" class="form-label">Description</label>
              <textarea class="form-control" id="categoryDescription" name="description" rows="3"></textarea>
            </div>
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">Save Category</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <!-- Optimized Dashboard JavaScript -->
  <script src="{% static 'js/dashboard.js' %}"></script>

  <!-- Lazy loading and performance optimizations -->
  <script>
    // Performance monitoring
    const perfData = {
      startTime: performance.now(),
      domReady: false,
      fullyLoaded: false
    };

    // DOM ready event
    document.addEventListener('DOMContentLoaded', function() {
      perfData.domReady = true;
      console.log('DOM ready in:', performance.now() - perfData.startTime, 'ms');

      // Initialize lazy loading for images
      initLazyLoading();

      // Initialize dashboard components
      initDashboard();
    });

    // Window load event
    window.addEventListener('load', function() {
      perfData.fullyLoaded = true;
      console.log('Page fully loaded in:', performance.now() - perfData.startTime, 'ms');
    });

    // Lazy loading function
    function initLazyLoading() {
      const images = document.querySelectorAll('img[data-src]');
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            observer.unobserve(img);
          }
        });
      });

      images.forEach(img => imageObserver.observe(img));
    }

    // Dashboard initialization
    function initDashboard() {
      // Tab functionality with lazy loading
      const tabEls = document.querySelectorAll('button[data-bs-toggle="tab"]');
      tabEls.forEach(tabEl => {
        tabEl.addEventListener('shown.bs.tab', function (event) {
          const targetId = event.target.getAttribute('data-bs-target');
          loadTabContent(targetId);
        });
      });

      // Initialize counters with requestAnimationFrame for better performance
      initAnimatedCounters();
    }

    // Load tab content dynamically
    function loadTabContent(tabId) {
      // This can be extended to load content via AJAX for better performance
      console.log('Loading content for tab:', tabId);
    }

    // Optimized animated counters
    function initAnimatedCounters() {
      const counters = document.querySelectorAll('.counter');
      if (counters.length === 0) return;

      const counterObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            animateCounter(entry.target);
            counterObserver.unobserve(entry.target);
          }
        });
      });

      counters.forEach(counter => counterObserver.observe(counter));
    }

    function animateCounter(counter) {
      const target = +counter.getAttribute('data-target') || 0;
      const duration = 1000; // 1 second
      const start = performance.now();
      const startValue = 0;

      function update(currentTime) {
        const elapsed = currentTime - start;
        const progress = Math.min(elapsed / duration, 1);

        // Easing function for smooth animation
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        const currentValue = Math.floor(startValue + (target - startValue) * easeOutQuart);

        counter.textContent = currentValue;

        if (progress < 1) {
          requestAnimationFrame(update);
        } else {
          counter.textContent = target;
        }
      }

      requestAnimationFrame(update);
    }
  </script>
{% endblock %}

{% block extra_css %}
  <!-- Optimized Dashboard Styles -->
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

  <!-- Critical CSS for above-the-fold content -->
  <style>
    /* Critical styles loaded immediately */
    .pagetitle { margin-bottom: 20px; padding: 15px 0; }
    .nav-tabs-wrapper {
      background: white;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }
    .card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    /* Lazy loading placeholder */
    .lazy {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .lazy.loaded {
      opacity: 1;
    }

    /* Performance optimizations */
    .counter {
      font-weight: 600;
      color: #495057;
    }
  </style>
{% endblock %}