{% extends 'layouts/base.html' %}

{% block content %}
<h3>Events</h3>

<div class="container">
    <form class="form-container" method="GET" action="{% url 'events' %}">
        <label for="status">Estado:</label>
        
        <select id="status" name="status">
            <option value="">-- Selecciona un estado --</option>  <!-- Elemento vacío -->
            {% for status in statuses %}
                <option value="{{ status.id }}" {% if status.id|stringformat:"s" == request.GET.status|default:'' %}selected{% endif %}>{{ status.status_name }}</option>
            {% endfor %}
        </select>
        

        <label for="date">Fecha:</label>
        <input type="date" id="date" name="date" {% if request.GET.date %}value="{{ request.GET.date }}" {% endif %}>

        <input type="submit" value="Filtrar">
        <a href="{% url 'events' %}"><button type="button">Restablecer</button></a>
    </form>
</div>
<p></p>

<div class="grid-container">
    {% for event in events %}
    <div class="card">
        <p>ID: {{ event.id }} {{ event.event_status.icon }}</p>
        <p>Fecha de creación: {{ event.created_at }}</p>
        <p>Fecha de estado: {{ event.updated_at }}</p>
        <h3>{{ event.title }}</h3>
        <p>{{ event.description }}</p>

        <form  action="{% url 'change_event_status' event.id %}" method="post">
            {% csrf_token %}

            <select name="new_status_id">
                {% for status in statuses %}
                <option value="{{ status.id }}" {% if status.id|stringformat:"s" == event.event_status.id|stringformat:"s" %}selected{% endif %}>{{ status.status_name }}</option>
                {% endfor %}
            </select>

            <input type="submit" value="Cambiar Estado">
        </form>

        <form action="{% url 'delete_event' event.id %}" method="post">
            {% csrf_token %}
            <input type="submit" value="Eliminar">
        </form>
    </div>
    {% endfor %}
</div>
{% endblock %}
