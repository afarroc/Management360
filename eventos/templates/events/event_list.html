{% extends 'layouts/base.html' %}

{% block content %}

{% if messages %}
<div class="alert alert-info">
    {% for message in messages %}
    <p{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</p>
    {% endfor %}
</div>
{% endif %}

<h2>Lista de Eventos</h2>

<style>
    /* Ajusta el alto de las celdas de la tabla al mínimo y quita el ajuste de texto */
    .table td, .table th {
        height: 1%;
        white-space: nowrap;
    }
    /* Establece un ancho máximo para la columna de descripción y maneja el desbordamiento de texto */
    .table td:nth-child(3) {
        max-width: 200px;  /* Ajusta este valor según tus necesidades */
        overflow: hidden;
        text-overflow: ellipsis;
    }
    /* Inmoviliza las dos primeras columnas */
    .table td:nth-child(-n+2), .table th:nth-child(-n+2) {
        position: sticky;
        left: 0;
        background: white;
        z-index: 1;
    }
</style>

<!-- Contenedor independiente para la tabla con desplazamiento vertical -->
<div style="overflow-x: auto; overflow-y: auto; max-height: 70vh;">
    <table class="table table-hover table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Título</th>
                <th>Descripción</th>
                <th>Estado</th>
                <th>Lugar</th>
                <th>Anfitrión</th>
                <th>Categoría</th>
                <th>Máximo de asistentes</th>
                <th>Precio del ticket</th>
                <th>Asignado a</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr>
                <td>{{ event.id }}</td>
                <td>{{ event.title }}</td>
                <td>{{ event.description }}</td>
                <td>{{ event.event_status.status_name }}</td>
                <td>{{ event.venue }}</td>
                <td>{{ event.host.username }}</td>
                <td>{{ event.event_category }}</td>
                <td>{{ event.max_attendees }}</td>
                <td>{{ event.ticket_price }}</td>
                <td>{{ event.assigned_to.username }}</td>
                <td>
                    <a href="{% url 'edit_event' event.id %}" class="btn btn-primary">
                        <i class="bi bi-pencil-fill"></i>
                    </a>
                    <!-- Formulario de eliminación -->
                    <form method="post" action="{% url 'delete_event' event.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash-fill"></i>
                        </button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="11">No hay eventos disponibles.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>  <!-- Fin del contenedor independiente para la tabla -->

<!-- Código de jQuery para desvanecer los mensajes de alerta -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    // Oculta los mensajes de alerta después de 5 segundos (5000 milisegundos)
    setTimeout(function() {
        $('.alert').fadeOut('slow');
    }, 5000);
});
</script>

{% endblock %}
